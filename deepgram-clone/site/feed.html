<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DeepGram - Feed</title>
    <link rel="stylesheet" href="css/da856031f36d61b4.css">
    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Header com comportamento de scroll */
        #main-header {
            transition: transform 0.3s ease-in-out;
        }
        
        #main-header.hidden {
            transform: translateY(-100%);
        }
        
        /* Pop-up estilo glassmorphism iOS */
        #blocked-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 38, 38, 0.15);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            color: white;
            padding: 24px 20px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.18);
            z-index: 1000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            max-width: 300px;
            width: calc(100% - 40px);
            text-align: center;
        }
        
        #blocked-popup.show {
            display: flex;
            animation: popupFadeIn 0.3s ease-out, subtlePulse 3s ease-in-out infinite 0.5s;
        }
        
        @keyframes popupFadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.97);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }
        
        @keyframes subtlePulse {
            0%, 100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                opacity: 0.98;
                transform: translate(-50%, -50%) scale(1.005);
            }
        }
        
        #blocked-popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 999;
            display: none;
        }
        
        #blocked-popup-overlay.show {
            display: block;
        }
        
        /* Notifica√ß√£o estilo Instagram iOS - Glassmorphism */
        #ios-notification {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(28, 28, 30, 0.8);
            backdrop-filter: blur(30px) saturate(180%);
            -webkit-backdrop-filter: blur(30px) saturate(180%);
            border-radius: 14px;
            padding: 10px 14px;
            border: 0.5px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4), inset 0 0.5px 0 rgba(255, 255, 255, 0.15);
            z-index: 1001;
            display: none;
            align-items: center;
            gap: 13px;
            width: calc(100% - 20px);
            max-width: 380px;
            cursor: pointer;
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
        }
        
        #ios-notification.show {
            display: flex;
            animation: notificationSlideIn 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        #ios-notification.hiding {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px) scale(0.95);
        }
        
        @keyframes notificationSlideIn {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-30px) scale(0.92);
            }
            60% {
                opacity: 0.8;
                transform: translateX(-50%) translateY(5px) scale(0.98);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0) scale(1);
            }
        }
        
        .notification-profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 0;
            overflow: hidden;
            flex-shrink: 0;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .notification-profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .notification-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0;
            min-width: 0;
            position: relative;
            line-height: 1.2;
        }
        
        .notification-time {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 13px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.5);
            white-space: nowrap;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
        }
        
        .notification-text-line {
            font-size: 15px;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.8);
            margin: 0;
            line-height: 1.2;
            letter-spacing: -0.01em;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "SF Pro Display", "Helvetica Neue", Helvetica, Arial, sans-serif;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .notification-text-line strong {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.85);
        }
        
        /* Ajuste proporcional para Galaxy S8 e telas similares (360px) */
        @media (max-width: 360px) {
            #ios-notification {
                width: calc(100% - 12px);
                max-width: 348px;
                padding: 9px 10px;
                gap: 10px;
            }
            
            .notification-profile-pic {
                width: 38px;
                height: 38px;
            }
            
            .notification-text-line {
                font-size: 14px;
                letter-spacing: -0.015em;
                padding-right: 0 !important;
            }
            
            .notification-time {
                font-size: 11px;
            }
            
            .notification-content {
                padding-right: 30px;
            }
        }
        
        /* Stories - Tamanho padr√£o */
        .story-button {
            position: relative;
            width: 69px;
            height: 69px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }
        
        .story-username {
            font-size: 12px;
            color: rgb(209, 213, 219);
            max-width: 70px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Ajustes para telas maiores (iPhone 12 Pro e similares) */
        @media (min-width: 390px) {
            .story-button {
                width: 79px;
                height: 79px;
            }
            
            .story-username {
                font-size: 13px;
                max-width: 75px;
            }
        }
        
        /* Container de stories - reduzir gap */
        #stories-container {
            gap: 10px !important;
        }
        
        
        /* Banner de pr√©via gr√°tis - fixo acima da navega√ß√£o inferior */
        #preview-banner {
            position: fixed;
            bottom: 56px;
            left: 2.5%;
            right: 2.5%;
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.98) 0%, rgba(59, 130, 246, 0.98) 100%);
            backdrop-filter: blur(24px) saturate(180%);
            -webkit-backdrop-filter: blur(24px) saturate(180%);
            border-top: 1px solid rgba(255, 255, 255, 0.25);
            box-shadow: 0 -8px 32px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
            z-index: 999;
            padding: 10px 16px;
            display: flex;
            align-items: flex-start;
            justify-content: flex-start;
            gap: 0;
            animation: slideUpBanner 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            border-radius: 16px 16px 0 0;
        }
        
        @keyframes slideUpBanner {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        #preview-banner.hidden {
            animation: slideDownBanner 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
        
        @keyframes slideDownBanner {
            from {
                transform: translateY(0);
                opacity: 1;
            }
            to {
                transform: translateY(100%);
                opacity: 0;
            }
        }
        
        .preview-banner-content {
            display: flex;
            flex-direction: column;
            gap: 0;
            flex: 1;
            min-width: 0;
            width: 100%;
            padding-right: 0;
        }
        
        .preview-banner-text {
            display: flex;
            flex-direction: column;
            gap: 0;
            width: 100%;
        }
        
        .preview-banner-title {
            font-size: 14px;
            font-weight: 700;
            color: white;
            margin: 0;
            margin-top: -9px;
            padding-top: 6px;
            line-height: 1.2;
            letter-spacing: -0.01em;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 3px;
        }
        
        .preview-banner-description {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.9);
            margin: 0;
            padding-top: 4px;
            line-height: 1.4;
            width: 100%;
        }
        
        .preview-timer-inline {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: transparent;
            padding: 0;
            font-size: 13px;
            font-weight: 700;
            color: white;
        }
        
        .preview-timer {
            display: flex;
            align-items: center;
            gap: 6px;
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            padding: 8px 14px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            min-width: 75px;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .preview-timer-icon {
            width: 14px;
            height: 14px;
            animation: pulseTimer 2s ease-in-out infinite;
            flex-shrink: 0;
        }
        
        .preview-timer-inline .preview-timer-icon {
            width: 12px;
            height: 12px;
        }
        
        @keyframes pulseTimer {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }
        
        .preview-banner-button {
            position: absolute;
            top: 0;
            right: 0;
            background: white;
            color: rgb(139, 92, 246);
            border: none;
            padding: 5px 11px;
            border-radius: 0 16px 0 8px;
            font-size: 13px;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.01em;
            z-index: 1;
            animation: buttonPulse 2s ease-in-out infinite;
            height: auto;
            line-height: 1.2;
        }
        
        @keyframes buttonPulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.9;
                transform: scale(1.02);
            }
        }
        
        @media (max-width: 640px) {
            #preview-banner {
                padding: 10px 16px;
            }
            
            .preview-banner-content {
                padding-right: 0;
            }
            
            .preview-banner-title {
                font-size: 13px;
                margin-top: -9px;
                padding-top: 6px;
            }
            
            .preview-banner-description {
                font-size: 11px;
                padding-top: 4px;
            }
            
            .preview-banner-button {
                top: 0;
                right: 0;
                width: fit-content;
                padding: 5px 11px;
                font-size: 12px;
                line-height: 1.2;
            }
            
            .preview-timer {
                padding: 5px 10px;
                font-size: 12px;
                min-width: 60px;
            }
        }
        
    </style>
</head>
<body style="background: rgb(11, 16, 20); font-family: Inter, system-ui, sans-serif; color: white; margin: 0; padding: 0;">
    <!-- Header -->
    <div id="main-header" style="position: fixed; top: 0; left: 0; right: 0; z-index: 50; padding: 12px 16px; background: rgb(11, 16, 20); display: flex; align-items: center; justify-content: space-between;">
        <div style="display: flex; align-items: center;">
            <img alt="Instagram" src="images/logo-insta.png" style="height: 28px; object-fit: contain; margin-top: 4px;">
        </div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <button class="blocked-action" style="position: relative; background: none; border: none; cursor: pointer;">
                <img alt="Curtidas" src="home-feed/icones/coracao.svg" style="width: 24px; height: 24px;">
                <span style="position: absolute; top: -4px; right: -4px; width: 8px; height: 8px; background: red; border-radius: 50%;"></span>
            </button>
            <a href="html-direct.html" style="position: relative; background: none; border: none; cursor: pointer; text-decoration: none; display: inline-block;">
                <img alt="Directs" src="home-feed/icones/enviar.svg" style="width: 24px; height: 24px;">
                <span id="unread-messages-count" style="position: absolute; top: -4px; right: -4px; min-width: 18px; height: 18px; background: red; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 10px; font-weight: bold; padding: 0 4px;">2</span>
            </a>
        </div>
    </div>

    <!-- Stories -->
    <div style="padding-top: 60px; padding-bottom: 160px;">
        <div style="padding: 12px 16px; overflow-x: auto;" class="hide-scrollbar">
            <div style="display: flex; gap: 12px;" id="stories-container">
                <!-- Stories ser√£o inseridos aqui via JavaScript -->
            </div>
        </div>

        <!-- Posts -->
        <div style="margin-top: 16px;" id="posts-container">
            <!-- Posts ser√£o inseridos aqui via JavaScript -->
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 1001; padding: 16px 24px; background: rgb(11, 16, 20); border-top: 1px solid rgb(38, 38, 38); display: flex; align-items: center; justify-content: space-between;">
        <button class="blocked-action"><img alt="Home" src="home-feed/icones/casa.svg" style="width: 24px; height: 24px;"></button>
        <button class="blocked-action"><img alt="Buscar" src="home-feed/icones/lupa.svg" style="width: 24px; height: 24px;"></button>
        <button class="blocked-action"><img alt="Adicionar" src="home-feed/icones/adicionar conteudo.svg" style="width: 24px; height: 24px;"></button>
        <button class="blocked-action"><img alt="Reels" src="home-feed/icones/reels.svg" style="width: 24px; height: 24px;"></button>
        <button style="position: relative;" class="blocked-action">
            <div style="width: 24px; height: 24px; border-radius: 50%; overflow: hidden; background: rgb(31, 41, 55); border: 2px solid white;">
                <img alt="Profile" id="nav-profile-pic" src="" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
        </button>
    </div>

    <!-- Pop-up vermelho para op√ß√µes bloqueadas -->
    <div id="blocked-popup-overlay"></div>
    <div id="blocked-popup">
        <!-- Conte√∫do ser√° inserido dinamicamente -->
    </div>

    <!-- Notifica√ß√£o estilo Instagram iOS -->
    <div id="ios-notification">
        <div class="notification-profile-pic" id="notification-profile-pic">
            <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: transparent; color: rgba(255,255,255,0.3); font-size: 20px; font-weight: 600;">?</div>
        </div>
        <div class="notification-content">
            <span class="notification-time">Agora</span>
            <p class="notification-text-line" style="margin: 0; margin-bottom: 1px; font-weight: 600; line-height: 1.2; padding-right: 10px;">
                Instagram
            </p>
            <p class="notification-text-line" id="notification-message" style="margin: 0; line-height: 1.2; padding-right: 10px;">
                NOME enviou uma mensagem: "Preciso falar contigo uma parada s√©ria".
            </p>
        </div>
    </div>

    <!-- Banner de pr√©via gr√°tis -->
    <div id="preview-banner">
        <div class="preview-banner-content">
            <div class="preview-banner-text">
                <p class="preview-banner-title">
                    ‚ö° Pr√©via dispon√≠vel por 
                    <span class="preview-timer-inline" id="preview-timer">
                        <span id="timer-text">5:00</span>
                        <svg class="preview-timer-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </span>
                </p>
                <p class="preview-banner-description">Voc√™ ganhou 5 minutos para testar gratuitamente nossa ferramenta, mas para liberar todas as funcionalidades e ter acesso permanente √© necess√°rio ser um membro VIP.</p>
            </div>
        </div>
        <button class="preview-banner-button" onclick="window.location.href='/cta'">Tornar-se VIP</button>
    </div>

    <script>
        // Fun√ß√£o para converter URL do Instagram para proxy
        function getProxyUrl(url) {
            if (url && url.includes('cdninstagram.com')) {
                // Se a p√°gina est√° em localhost:8001, usar o servidor da API na porta 8002
                const currentPort = window.location.port;
                const proxyBase = (currentPort === '8001' || currentPort === '8000') 
                    ? 'http://localhost:8002' 
                    : '';
                return proxyBase + '/proxy-image?url=' + encodeURIComponent(url);
            }
            return url;
        }

        // Fun√ß√£o para normalizar regi√£o (converter nome completo para sigla)
        function normalizeRegion(region) {
            if (!region) return '';
            
            const regionMap = {
                'paran√°': 'PR', 'parana': 'PR',
                's√£o paulo': 'SP', 'sao paulo': 'SP',
                'rio de janeiro': 'RJ',
                'minas gerais': 'MG',
                'rio grande do sul': 'RS',
                'santa catarina': 'SC',
                'bahia': 'BA',
                'goi√°s': 'GO', 'goias': 'GO',
                'pernambuco': 'PE',
                'cear√°': 'CE', 'ceara': 'CE',
                'distrito federal': 'DF',
                'esp√≠rito santo': 'ES', 'espirito santo': 'ES',
                'mato grosso': 'MT',
                'mato grosso do sul': 'MS',
                'par√°': 'PA', 'para': 'PA',
                'amazonas': 'AM'
            };
            
            const regionLower = region.toLowerCase().trim();
            
            // Se j√° √© sigla (2 letras), retornar como est√°
            if (region.length === 2 && region.match(/^[A-Z]{2}$/i)) {
                return region.toUpperCase();
            }
            
            // Tentar encontrar no mapa
            for (const [key, sigla] of Object.entries(regionMap)) {
                if (regionLower.includes(key) || key.includes(regionLower)) {
                    return sigla;
                }
            }
            
            return region;
        }
        
        // Fun√ß√£o para obter localiza√ß√£o do usu√°rio via IP
        async function getUserLocation() {
            // SEMPRE buscar localiza√ß√£o nova (n√£o usar cache para garantir dados corretos)
            // Remover cache antigo se existir
            const cachedLocation = localStorage.getItem('userLocation');
            if (cachedLocation) {
                console.log('üóëÔ∏è Removendo cache antigo:', cachedLocation);
                localStorage.removeItem('userLocation');
            }
            
            // Tentar m√∫ltiplas APIs para garantir que pegamos a localiza√ß√£o
            const apis = [
                {
                    url: 'https://ip-api.com/json/?fields=status,message,city,regionName,region,country,lat,lon',
                    parser: (data) => {
                        if (data.status === 'success' && data.city) {
                            // Converter nome completo do estado para sigla se necess√°rio
                            let region = data.region || data.regionName || '';
                            region = normalizeRegion(region);
                            
                            return {
                                city: data.city,
                                region: region,
                                country: data.country || 'Brasil',
                                lat: data.lat,
                                lon: data.lon
                            };
                        }
                        return null;
                    }
                },
                {
                    url: 'https://ipapi.co/json/',
                    parser: (data) => {
                        if (data.city && !data.error) {
                            let region = data.region || data.region_code || '';
                            region = normalizeRegion(region);
                            
                            return {
                                city: data.city,
                                region: region,
                                country: data.country_name || 'Brasil',
                                lat: data.latitude,
                                lon: data.longitude
                            };
                        }
                        return null;
                    }
                },
                {
                    url: 'https://geolocation-db.com/json/',
                    parser: (data) => {
                        if (data.city) {
                            let region = data.state || '';
                            region = normalizeRegion(region);
                            
                            return {
                                city: data.city,
                                region: region,
                                country: data.country_name || 'Brasil',
                                lat: data.latitude,
                                lon: data.longitude
                            };
                        }
                        return null;
                    }
                },
                {
                    url: 'https://api.ipify.org?format=json',
                    getIp: true,
                    parser: async (ip) => {
                        try {
                            const response = await fetch(`https://ip-api.com/json/${ip}?fields=status,city,regionName,region,country,lat,lon`);
                            const data = await response.json();
                            if (data.status === 'success' && data.city) {
                                let region = data.region || data.regionName || '';
                                region = normalizeRegion(region);
                                
                                return {
                                    city: data.city,
                                    region: region,
                                    country: data.country || 'Brasil',
                                    lat: data.lat,
                                    lon: data.lon
                                };
                            }
                        } catch (e) {
                            console.error('Erro ao obter localiza√ß√£o do IP:', e);
                        }
                        return null;
                    }
                },
                {
                    url: 'https://api.db-ip.com/v2/free/self',
                    parser: (data) => {
                        if (data.city) {
                            let region = data.subdivision || '';
                            region = normalizeRegion(region);
                            
                            return {
                                city: data.city,
                                region: region,
                                country: data.countryName || 'Brasil',
                                lat: data.latitude,
                                lon: data.longitude
                            };
                        }
                        return null;
                    }
                },
                {
                    url: 'https://api.country.is/',
                    parser: async () => {
                        try {
                            const ipResponse = await fetch('https://api.ipify.org?format=json');
                            const ipData = await ipResponse.json();
                            const ip = ipData.ip;
                            
                            const geoResponse = await fetch(`https://ipapi.co/${ip}/json/`);
                            const geoData = await geoResponse.json();
                            
                            if (geoData.city && !geoData.error) {
                                let region = geoData.region || geoData.region_code || '';
                                region = normalizeRegion(region);
                                
                                return {
                                    city: geoData.city,
                                    region: region,
                                    country: geoData.country_name || 'Brasil',
                                    lat: geoData.latitude,
                                    lon: geoData.longitude
                                };
                            }
                        } catch (e) {
                            console.error('Erro na API alternativa:', e);
                        }
                        return null;
                    }
                }
            ];
            
            for (const api of apis) {
                try {
                    console.log('üîç Tentando obter localiza√ß√£o de:', api.url);
                    
                    let location = null;
                    
                    if (api.getIp) {
                        // Primeiro obter IP, depois localiza√ß√£o
                        const ipResponse = await fetch(api.url);
                        const ipData = await ipResponse.json();
                        location = await api.parser(ipData.ip);
                    } else if (api.parser.constructor.name === 'AsyncFunction') {
                        // Parser ass√≠ncrono
                        location = await api.parser();
                    } else {
                        // Parser s√≠ncrono normal
                        const response = await fetch(api.url, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                            },
                            mode: 'cors'
                        });
                        
                        if (!response.ok) {
                            console.warn('‚ö†Ô∏è Resposta n√£o OK:', response.status);
                            continue;
                        }
                        
                        const data = await response.json();
                        console.log('üì¶ Dados recebidos:', data);
                        location = api.parser(data);
                    }
                    
                    if (location && location.city) {
                        console.log('‚úÖ Localiza√ß√£o obtida:', location.city, '| Regi√£o:', location.region);
                        console.log('üìã Dados completos:', location);
                        
                        // Salvar no localStorage
                        localStorage.setItem('userLocation', JSON.stringify(location));
                        
                        return location;
                    } else {
                        console.warn('‚ö†Ô∏è Cidade n√£o encontrada nos dados');
                    }
                } catch (error) {
                    console.error('‚ùå Erro ao obter localiza√ß√£o de', api.url, ':', error.message);
                    continue; // Tentar pr√≥xima API
                }
            }
            
            // Se nenhuma API funcionou, retornar null para n√£o mostrar cidade
            console.error('‚ùå N√£o foi poss√≠vel obter localiza√ß√£o de nenhuma API');
            return null;
        }
        
        // Fun√ß√£o para obter cidades pr√≥ximas usando coordenadas geogr√°ficas
        async function getNearbyCities(lat, lon, userCity) {
            try {
                // Usar API do OpenStreetMap Nominatim para buscar cidades pr√≥ximas
                // Buscar cidades em um raio de ~50km
                const radius = 0.5; // ~50km em graus
                const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`;
                
                console.log('üîç Buscando cidades pr√≥ximas via coordenadas:', lat, lon);
                
                const response = await fetch(url, {
                    headers: {
                        'User-Agent': 'Mozilla/5.0'
                    }
                });
                
                const data = await response.json();
                
                if (data && data.address) {
                    const currentCity = data.address.city || data.address.town || data.address.village || userCity;
                    
                    // Buscar cidades pr√≥ximas usando uma busca por regi√£o
                    const nearbyUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(currentCity)}&limit=10&addressdetails=1`;
                    const nearbyResponse = await fetch(nearbyUrl, {
                        headers: {
                            'User-Agent': 'Mozilla/5.0'
                        }
                    });
                    
                    const nearbyData = await nearbyResponse.json();
                    
                    if (nearbyData && nearbyData.length > 0) {
                        // Extrair cidades √∫nicas dos resultados
                        const cities = new Set();
                        cities.add(userCity); // Adicionar cidade do usu√°rio
                        
                        nearbyData.forEach(item => {
                            if (item.address) {
                                const city = item.address.city || item.address.town || item.address.village;
                                if (city && city.toLowerCase() !== userCity.toLowerCase()) {
                                    cities.add(city);
                                }
                            }
                        });
                        
                        const citiesArray = Array.from(cities).slice(0, 5);
                        console.log('‚úÖ Cidades pr√≥ximas encontradas:', citiesArray);
                        return citiesArray;
                    }
                }
            } catch (error) {
                console.error('‚ùå Erro ao buscar cidades pr√≥ximas:', error);
            }
            
            // Fallback: retornar apenas a cidade do usu√°rio
            return [userCity];
        }
        
        // Fun√ß√£o para gerar lista de cidades (cidade do usu√°rio + cidades pr√≥ximas via API)
        async function generateNearbyCities(userCity, userRegion, lat, lon) {
            if (lat && lon) {
                // Buscar cidades pr√≥ximas usando coordenadas
                const nearbyCities = await getNearbyCities(lat, lon, userCity);
                return nearbyCities;
            }
            
            // Se n√£o temos coordenadas, retornar apenas a cidade do usu√°rio
            console.log('‚ö†Ô∏è Coordenadas n√£o dispon√≠veis, usando apenas cidade do usu√°rio');
            return [userCity];
        }
        
        // Fun√ß√£o para mascarar username (mostra 3 letras + *****)
        function maskUsername(username) {
            if (!username || username.length === 0) {
                return 'xxx*****';
            }
            // Se o username j√° cont√©m asteriscos, extrair as letras antes dos asteriscos
            if (username.includes('*')) {
                const lettersOnly = username.split('*')[0]; // Pegar apenas a parte antes dos asteriscos
                if (lettersOnly.length >= 3) {
                    return lettersOnly.substring(0, 3) + '*****';
                } else if (lettersOnly.length > 0) {
                    return lettersOnly + '*****';
                }
                return 'xxx*****';
            }
            // Mostrar 3 letras + *****
            const visibleChars = username.length >= 3 ? username.substring(0, 3) : username;
            return visibleChars + '*****';
        }

        // Fun√ß√£o para mostrar pop-up vermelho de bloqueio
        function showBlockedPopup(functionName) {
            const popup = document.getElementById('blocked-popup');
            const overlay = document.getElementById('blocked-popup-overlay');
            
            // Mapear nomes de fun√ß√µes para o texto correto
            let actionText = 'a esta a√ß√£o';
            if (functionName) {
                const lowerName = functionName.toLowerCase();
                if (lowerName.includes('story') || lowerName.includes('visualizar story')) {
                    actionText = 'aos stories';
                } else if (lowerName.includes('curtir') || lowerName.includes('like')) {
                    actionText = '√†s curtidas';
                } else if (lowerName.includes('reels')) {
                    actionText = 'aos reels';
                } else if (lowerName.includes('perfil') || lowerName.includes('profile')) {
                    actionText = 'ao perfil';
                } else if (lowerName.includes('notifica√ß√£o') || lowerName.includes('notificacao')) {
                    actionText = '√†s notifica√ß√µes';
                } else if (lowerName.includes('comentar')) {
                    actionText = 'aos coment√°rios';
                } else if (lowerName.includes('repost')) {
                    actionText = 'ao repostar';
                } else if (lowerName.includes('enviar')) {
                    actionText = 'ao enviar';
                } else if (lowerName.includes('salvar')) {
                    actionText = 'ao salvar';
                } else if (lowerName.includes('buscar')) {
                    actionText = '√† busca';
                } else if (lowerName.includes('adicionar')) {
                    actionText = 'ao adicionar conte√∫do';
                } else if (lowerName.includes('home')) {
                    actionText = 'ao home';
                } else if (lowerName.includes('mais op√ß√µes')) {
                    actionText = '√†s op√ß√µes';
                }
            }
            
            if (popup && overlay) {
                // Criar conte√∫do do pop-up estilo iOS glassmorphism
                popup.innerHTML = `
                    <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 10px 0; letter-spacing: -0.1px; opacity: 0.95;">
                        ‚ö†Ô∏é A√ß√£o bloqueada
                    </h3>
                    <p style="font-size: 13px; opacity: 0.85; margin: 0 0 20px 0; line-height: 1.4; font-weight: 400;">
                        Seja um membro VIP do In'Stalker para ter acesso ${actionText}
                    </p>
                    <button onclick="window.location.href='/cta'" style="background: rgba(255, 255, 255, 0.3); color: white; padding: 10px 20px; border-radius: 10px; font-weight: 500; font-size: 13px; border: 1px solid rgba(255, 255, 255, 0.3); cursor: pointer; width: 100%; transition: all 0.2s; backdrop-filter: blur(10px);" onmouseover="this.style.background='rgba(255, 255, 255, 0.4)'; this.style.borderColor='rgba(255, 255, 255, 0.4)'" onmouseout="this.style.background='rgba(255, 255, 255, 0.3)'; this.style.borderColor='rgba(255, 255, 255, 0.3)'">
                        Adquirir Acesso VIP
                    </button>
                `;
                
                popup.classList.add('show');
                overlay.classList.add('show');
                
                // Fechar ao clicar no overlay
                overlay.onclick = function() {
                    popup.classList.remove('show');
                    overlay.classList.remove('show');
                };
                
                // Fechar ap√≥s 5 segundos
                setTimeout(() => {
                    popup.classList.remove('show');
                    overlay.classList.remove('show');
                }, 5000);
            }
        }

        // Adicionar event listeners para op√ß√µes bloqueadas ap√≥s o conte√∫do ser carregado
        function setupBlockedActions() {
            // Usar event delegation para capturar cliques em todos os bot√µes bloqueados
            document.addEventListener('click', function(e) {
                const button = e.target.closest('.blocked-action');
                if (button) {
    e.preventDefault();
                    e.stopPropagation();
                    
                    // Identificar qual fun√ß√£o foi clicada
                    let functionName = 'Esta funcionalidade';
                    const img = button.querySelector('img');
                    if (img) {
                        const alt = img.getAttribute('alt') || '';
                        if (alt.includes('Curtidas') || alt.includes('Curtir')) functionName = 'Curtir';
                        else if (alt.includes('Comentar')) functionName = 'Comentar';
                        else if (alt.includes('Repost')) functionName = 'Repostar';
                        else if (alt.includes('Enviar')) functionName = 'Enviar';
                        else if (alt.includes('Salvar')) functionName = 'Salvar';
                        else if (alt.includes('Buscar')) functionName = 'Buscar';
                        else if (alt.includes('Adicionar')) functionName = 'Adicionar conte√∫do';
                        else if (alt.includes('Reels')) functionName = 'Reels';
                        else if (alt.includes('Home')) functionName = 'Home';
                        else if (alt.includes('Profile') || alt.includes('Perfil')) functionName = 'Perfil';
                    }
                    
                    // Verificar se √© o bot√£o de mais op√ß√µes (3 pontos)
                    if (button.querySelector('svg circle')) {
                        functionName = 'Mais op√ß√µes';
                    }
                    
                    showBlockedPopup(functionName);
                }
            }, true);
            
            // Bloquear cliques nos stories
            document.addEventListener('click', function(e) {
                // Verificar se o clique foi em um story (dentro do container de stories)
                const storiesContainer = document.getElementById('stories-container');
                if (storiesContainer && storiesContainer.contains(e.target)) {
                    // Verificar se √© um bot√£o de story ou imagem de story
                    const storyButton = e.target.closest('button');
                    const storyDiv = e.target.closest('div[style*="display: flex"][style*="flex-direction: column"]');
                    
                    if (storyButton || storyDiv) {
                        // Verificar se n√£o √© o story do pr√≥prio usu√°rio
                        const storyText = storyDiv?.querySelector('span')?.textContent;
                        if (storyText && storyText !== 'Seu story') {
                            e.preventDefault();
                            e.stopPropagation();
                            showBlockedPopup('Visualizar story');
                            return false;
                        }
                    }
                }
            }, true);

            // Funcionalidade de curtir
            document.addEventListener('click', function(e) {
                const likeButton = e.target.closest('.like-button');
                if (likeButton) {
                    e.preventDefault();
                    e.stopPropagation();
                    const postIndex = parseInt(likeButton.getAttribute('data-post-index'));
                    const isLiked = likeButton.getAttribute('data-liked') === 'true';
                    const likesCountButton = document.querySelector(`.likes-count-button[data-post-index="${postIndex}"]`);
                    
                    // Alternar estado
                    const newLikedState = !isLiked;
                    likeButton.setAttribute('data-liked', newLikedState);
                    
                    // Atualizar √≠cone
                    const img = likeButton.querySelector('img');
                    if (img) {
                        img.src = newLikedState ? 'home-feed/icones/coracao-curtido.svg' : 'home-feed/icones/coracao.svg';
                    }
                    
                    // Atualizar contador de curtidas
                    if (likesCountButton) {
                        let currentLikes = parseInt(likesCountButton.getAttribute('data-likes')) || 0;
                        currentLikes = newLikedState ? currentLikes + 1 : currentLikes - 1;
                        likesCountButton.setAttribute('data-likes', currentLikes);
                        likesCountButton.textContent = currentLikes + ' curtidas';
                    }
                }
            }, true);

            // Funcionalidade de salvar
            document.addEventListener('click', function(e) {
                const saveButton = e.target.closest('.save-button');
                if (saveButton) {
                    e.preventDefault();
                    e.stopPropagation();
                    const isSaved = saveButton.getAttribute('data-saved') === 'true';
                    
                    // Alternar estado
                    const newSavedState = !isSaved;
                    saveButton.setAttribute('data-saved', newSavedState);
                    
                    // Atualizar √≠cone
                    const img = saveButton.querySelector('img');
                    if (img) {
                        img.src = newSavedState ? 'home-feed/icones/salvar-salvado.svg' : 'home-feed/icones/salvar.svg';
                    }
                }
            }, true);
        }

        // Carregar dados do localStorage
        async function loadFeedData() {
            console.log('üöÄ loadFeedData() iniciada');
            // Ler username da URL se dispon√≠vel
            const urlParams = new URLSearchParams(window.location.search);
            const urlUsername = urlParams.get('username');
            console.log('üìã Username da URL:', urlUsername);
            
            // Usar username da URL se n√£o houver no localStorage
            let username = localStorage.getItem('username') || urlUsername;
            
            // Se veio da URL e n√£o est√° no localStorage, salvar
            if (urlUsername && !localStorage.getItem('username')) {
                username = urlUsername;
                localStorage.setItem('username', username);
            }
            
            // Se n√£o tem username, n√£o pode continuar
            if (!username) {
                console.error('‚ùå Username n√£o encontrado no localStorage nem na URL');
                return;
            }
            
            let userId = localStorage.getItem('userId') || localStorage.getItem('userPk') || localStorage.getItem('user_id') || localStorage.getItem('pk');
            let profilePicUrl = localStorage.getItem('userProfilePic');
            let followersCount = localStorage.getItem('followersCount') || '0';
            let followingCount = localStorage.getItem('followingCount') || '0';
            let postCount = localStorage.getItem('postCount') || '0';
            let fullName = localStorage.getItem('fullName') || '';
            let bio = localStorage.getItem('bio') || '';
            
            // Se n√£o tem dados do usu√°rio e tem username da URL, buscar da API
            if (urlUsername && (!profilePicUrl || !userId)) {
                try {
                    console.log('üîç Buscando dados do usu√°rio da API:', urlUsername);
                    const userResponse = await fetch(`http://localhost:8002/api/user?username=${encodeURIComponent(urlUsername)}`);
                    if (userResponse.ok) {
                        const userData = await userResponse.json();
                        if (userData.user) {
                            const user = userData.user;
                            userId = user.pk || user.id || userId;
                            profilePicUrl = user.profile_pic_url || user.profile_pic_url_hd || profilePicUrl;
                            fullName = user.full_name || fullName;
                            bio = user.biography || bio;
                            followersCount = user.follower_count || followersCount;
                            followingCount = user.following_count || followingCount;
                            postCount = user.media_count || postCount;
                            
                            // Salvar no localStorage
                            if (userId) localStorage.setItem('userId', userId);
                            if (profilePicUrl) localStorage.setItem('userProfilePic', profilePicUrl);
                            if (fullName) localStorage.setItem('fullName', fullName);
                            if (bio) localStorage.setItem('bio', bio);
                            if (followersCount) localStorage.setItem('followersCount', followersCount);
                            if (followingCount) localStorage.setItem('followingCount', followingCount);
                            if (postCount) localStorage.setItem('postCount', postCount);
                            
                            console.log('‚úÖ Dados do usu√°rio carregados da API');
                        }
                    }
                } catch (e) {
                    console.error('‚ùå Erro ao buscar dados do usu√°rio:', e);
                }
            }
            
            let storiesRaw = localStorage.getItem('stories_' + username);
            
            let stories = [];
            if (storiesRaw) {
                try {
                    stories = JSON.parse(storiesRaw);
                } catch (e) {
                    console.error('Erro ao parsear stories:', e);
                }
            }
            
            // Se n√£o tem stories no localStorage e tem username, buscar da API
            if ((!storiesRaw || stories.length === 0) && username) {
                try {
                    console.log('üîç Buscando stories da API:', username);
                    const storiesResponse = await fetch(`http://localhost:8002/api/stories?username=${encodeURIComponent(username)}`);
                    if (storiesResponse.ok) {
                        const storiesData = await storiesResponse.json();
                        if (storiesData.stories && Array.isArray(storiesData.stories) && storiesData.stories.length > 0) {
                            // Processar stories para garantir formato correto
                            stories = storiesData.stories.map(story => ({
                                username: story.username || story.user?.username || '',
                                image: story.image || story.image_url || story.user?.profile_pic_url || '',
                                image_url: story.image_url || story.image || story.user?.profile_pic_url || ''
                            })).filter(s => s.username && s.image);
                            
                            // Salvar no localStorage
                            localStorage.setItem('stories_' + username, JSON.stringify(stories));
                            console.log('‚úÖ Stories carregados da API:', stories.length);
                        }
                    }
                } catch (e) {
                    console.error('‚ùå Erro ao buscar stories:', e);
                }
            }

            // Buscar dados de following do localStorage
            let following = [];
            const followingKey = userId ? `following_${userId}` : `following_${username}`;
            const followingRaw = localStorage.getItem(followingKey);
            
            if (followingRaw) {
                try {
                    following = JSON.parse(followingRaw);
                    console.log('‚úÖ Following carregado para posts:', following.length, 'usu√°rios');
                } catch (e) {
                    console.error('Erro ao parsear following:', e);
                }
            }

            // Se n√£o encontrou following, tentar buscar de outras chaves poss√≠veis
            if (following.length === 0) {
                const altKeys = ['following', `following_${username}`, 'following_users'];
                for (const key of altKeys) {
                    const altRaw = localStorage.getItem(key);
                    if (altRaw) {
                        try {
                            following = JSON.parse(altRaw);
                            console.log('‚úÖ Following encontrado na chave:', key, following.length, 'usu√°rios');
                            break;
                        } catch (e) {
                            console.error('Erro ao parsear following da chave', key, ':', e);
                        }
                    }
                }
            }
            
            // Se n√£o tem following no localStorage e tem username, buscar da API
            if (following.length === 0 && username) {
                try {
                    console.log('üîç Buscando following da API:', username);
                    const followingResponse = await fetch(`http://localhost:8002/api/following?username=${encodeURIComponent(username)}`);
                    if (followingResponse.ok) {
                        const followingData = await followingResponse.json();
                        if (followingData.following && Array.isArray(followingData.following) && followingData.following.length > 0) {
                            following = followingData.following;
                            
                            // Salvar no localStorage
                            const followingKeyToSave = userId ? `following_${userId}` : `following_${username}`;
                            localStorage.setItem(followingKeyToSave, JSON.stringify(following));
                            console.log('‚úÖ Following carregado da API:', following.length);
                        }
                    }
                } catch (e) {
                    console.error('‚ùå Erro ao buscar following:', e);
                }
            }

            // Renderizar stories
            console.log('üé® Renderizando stories...', { username, profilePicUrl, storiesCount: stories.length });
            const storiesContainer = document.getElementById('stories-container');
            console.log('üì¶ Stories container encontrado:', !!storiesContainer);
            
            if (!storiesContainer) {
                console.error('‚ùå Container de stories n√£o encontrado!');
                return;
            }
            
            if (!username) {
                console.error('‚ùå Username n√£o encontrado!');
                return;
            }
            
            if (storiesContainer && username) {
                // Story do usu√°rio principal
                const userStoryImage = profilePicUrl 
                    ? `<img alt="${username}" src="${getProxyUrl(profilePicUrl)}" style="width: 100%; height: 100%; object-fit: cover;">`
                    : `<div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 20px; font-weight: bold; background: rgb(31, 41, 55);">${username.charAt(0).toUpperCase()}</div>`;
                
                storiesContainer.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                        <button class="story-button">
                            <div style="width: 100%; height: 100%; border-radius: 50%; padding: 2px; background: linear-gradient(135deg, rgb(235, 28, 143), rgb(223, 179, 19));">
                                <div style="width: 100%; height: 100%; border-radius: 50%; background: rgb(11, 16, 20); padding: 2px;">
                                    <div style="width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background: rgb(31, 41, 55); position: relative;">
                                        ${userStoryImage}
                                    </div>
                                </div>
                            </div>
                        </button>
                        <span class="story-username">Seu story</span>
                    </div>
                `;

                // Outros stories - todos normais primeiro
                console.log('üìä Total de stories:', stories.length);
                const validStories = stories.slice(1).filter(story => story && story.image && story.username);
                console.log('‚úÖ Stories v√°lidos (ap√≥s filtro):', validStories.length);
                
                // Verificar se j√° existe ordem salva no localStorage
                const STORIES_ORDER_KEY = 'stories_order_' + username;
                let orderedStories = [...validStories];
                
                const storedOrder = localStorage.getItem(STORIES_ORDER_KEY);
                const currentUsernames = validStories.map(s => s.username).sort().join(',');
                
                if (storedOrder) {
                    try {
                        const savedOrder = JSON.parse(storedOrder);
                        const savedUsernames = savedOrder.map(s => s.username).sort().join(',');
                        
                        // Se os usernames s√£o os mesmos, usar ordem salva
                        if (savedUsernames === currentUsernames) {
                            // Restaurar ordem salva
                            const usernameToStory = {};
                            validStories.forEach(s => usernameToStory[s.username] = s);
                            orderedStories = savedOrder.map(s => usernameToStory[s.username]).filter(Boolean);
                        }
                    } catch (e) {
                        console.error('Erro ao parsear ordem dos stories:', e);
                    }
                }
                
                // Se n√£o tem ordem salva ou mudou, criar nova
                if (orderedStories.length !== validStories.length || 
                    orderedStories.map(s => s.username).sort().join(',') !== currentUsernames) {
                    // Embaralhar os stories aleatoriamente
                    for (let i = orderedStories.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [orderedStories[i], orderedStories[j]] = [orderedStories[j], orderedStories[i]];
                    }
                    // Salvar ordem
                    localStorage.setItem(STORIES_ORDER_KEY, JSON.stringify(orderedStories.map(s => ({ username: s.username }))));
                }
                
                // Renderizar todos os stories normais (sem blur)
                orderedStories.forEach((story, index) => {
                    const maskedUsername = story.username.includes('*') ? story.username : maskUsername(story.username);
                    
                    storiesContainer.innerHTML += `
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                                <button class="story-button">
                                    <div style="width: 100%; height: 100%; border-radius: 50%; padding: 2px; background: linear-gradient(135deg, rgb(235, 28, 143), rgb(223, 179, 19));">
                                        <div style="width: 100%; height: 100%; border-radius: 50%; background: rgb(11, 16, 20); padding: 2px;">
                                            <div style="width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background: rgb(31, 41, 55); position: relative;">
                                                <img alt="${maskedUsername}" src="${getProxyUrl(story.image)}" style="width: 100%; height: 100%; object-fit: cover;">
                                            </div>
                                        </div>
                                    </div>
                                </button>
                                <span class="story-username">${maskedUsername}</span>
                            </div>
                        `;
                });
                
                // Duplicar todos os stories com blur e cadeado
                const usernameLetters = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
                orderedStories.forEach((story, index) => {
                    // Gerar username com apenas 1 letra vis√≠vel
                    const randomLetter = usernameLetters[index % usernameLetters.length] || usernameLetters[Math.floor(Math.random() * usernameLetters.length)];
                    const maskedUsername = randomLetter + '******';
                    
                    storiesContainer.innerHTML += `
                            <div style="display: flex; flex-direction: column; align-items: center; gap: 4px;">
                                <button class="story-button">
                                    <div style="width: 100%; height: 100%; border-radius: 50%; padding: 2px; background: linear-gradient(135deg, rgb(235, 28, 143), rgb(223, 179, 19));">
                                        <div style="width: 100%; height: 100%; border-radius: 50%; background: rgb(11, 16, 20); padding: 2px;">
                                            <div style="width: 100%; height: 100%; border-radius: 50%; overflow: hidden; background: rgb(55, 65, 81); position: relative; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);">
                                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; z-index: 10;">
                                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                                    </svg>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </button>
                                <span class="story-username">${maskedUsername}</span>
                            </div>
                        `;
                });
            }

            // Atualizar foto de perfil na navega√ß√£o inferior
            const navProfilePic = document.getElementById('nav-profile-pic');
            if (navProfilePic && profilePicUrl) {
                navProfilePic.src = getProxyUrl(profilePicUrl);
            }

            // Renderizar m√∫ltiplos posts com rea√ß√µes
            const postsContainer = document.getElementById('posts-container');
            if (postsContainer && username) {
                // Dados dos posts usando following
                const defaultPosts = [
                    { likes: 46, comments: 9, reposts: 3, liked: true, saved: false, date: '18 de novembro', caption: 'perfeita como sempre ü©∑ü©∑', aspectRatio: '1 / 1' },
                    { likes: 28, comments: 5, reposts: 1, liked: false, saved: true, date: '19 de novembro', caption: 'gostoso demais üî•', aspectRatio: '3 / 2' },
                    { likes: 21, comments: 5, reposts: 2, liked: true, saved: false, date: '17 de novembro', caption: 'casa cmg???', aspectRatio: '3 / 2' },
                    { likes: 51, comments: 13, reposts: 4, liked: true, saved: false, date: '18 de novembro', caption: 'nem me responde ne ? üî•', aspectRatio: '1 / 1', locked: true }
                ];

                // Criar posts usando dados de following e stories
                // Usar stories para pegar as fotos (igual funciona nos stories)
                // Primeiro, criar um array com todos os stories/following dispon√≠veis (exceto o primeiro que √© o usu√°rio principal)
                const availableUsers = [];
                for (let i = 1; i < Math.max(stories.length, following.length); i++) {
                    const story = stories[i] || null;
                    const followingUser = following[i] || null;
                    
                    if (story || followingUser) {
                    let displayUsername = 'xxx*****';
                    let userProfilePic = '';
                    
                    // Priorizar story porque j√° tem foto funcionando
                    if (story && story.image && story.username) {
                        // Sempre aplicar maskUsername para garantir 3 letras
                        displayUsername = maskUsername(story.username);
                        userProfilePic = story.image;
                    } else if (followingUser) {
                        const username = followingUser.username || '';
                        if (username.length > 0) {
                            displayUsername = maskUsername(username);
                        }
                        userProfilePic = followingUser.profile_pic_url || '';
                    }
                        
                        availableUsers.push({
                            username: displayUsername,
                            profilePic: userProfilePic,
                            fullName: followingUser?.full_name || ''
                        });
                    }
                }
                
                // Sistema de ordem fixa dos posts (salvar no localStorage)
                const POSTS_ORDER_KEY = 'feedPostsOrder_v1';
                let postsData;
                
                // Verificar se j√° existe ordem salva
                const savedPostsOrder = localStorage.getItem(POSTS_ORDER_KEY);
                
                if (savedPostsOrder) {
                    try {
                        postsData = JSON.parse(savedPostsOrder);
                        console.log('‚úÖ Posts carregados do cache (ordem fixa)');
                    } catch (e) {
                        console.error('Erro ao parsear posts salvos:', e);
                        postsData = null;
                    }
                }
                
                // Se n√£o tem posts salvos, criar nova ordem e salvar
                if (!postsData || postsData.length === 0) {
                    console.log('üîÑ Gerando nova ordem de posts (s√≥ acontece 1x)');
                    
                    // Embaralhar APENAS uma vez
                    function shuffleArray(array) {
                        const shuffled = [...array];
                        for (let i = shuffled.length - 1; i > 0; i--) {
                            const j = Math.floor(Math.random() * (i + 1));
                            [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                        }
                        return shuffled;
                    }
                    
                    const shuffledUsers = shuffleArray(availableUsers);
                    
                    // Criar posts e SALVAR no localStorage
                    postsData = defaultPosts.map((defaultPost, index) => {
                        const userIndex = index % shuffledUsers.length;
                        const selectedUser = shuffledUsers[userIndex] || { username: 'xxx*****', profilePic: '', fullName: '' };
                        
                        return {
                            ...defaultPost,
                            username: selectedUser.username,
                            profilePic: selectedUser.profilePic,
                            fullName: selectedUser.fullName
                        };
                    });
                    
                    // Salvar ordem permanentemente
                    localStorage.setItem(POSTS_ORDER_KEY, JSON.stringify(postsData));
                    console.log('üíæ Ordem dos posts salva permanentemente');
                }

                // SEMPRE usar "Local Oculto"
                const getNextCity = () => 'Local Oculto';
                
                // Manter a ordem original dos posts, apenas as fotos s√£o aleat√≥rias
                postsContainer.innerHTML = postsData.map((post, index) => {
                    const postDate = new Date();
                    postDate.setDate(postDate.getDate() - (index + 1));
                    const formattedDate = postDate.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
                    const time = ['02:11', '09:43', '08:53', '08:26'][index] || '00:00';
                    
                    // Usar foto do story/following (j√° vem com getProxyUrl aplicado se necess√°rio)
                    const postProfilePic = post.profilePic ? getProxyUrl(post.profilePic) : '';
                    
                    // Usar sempre a cidade do usu√°rio
                    const locationText = getNextCity();
                    
                    return `
                        <div style="background: rgb(11, 16, 20); margin-bottom: 16px;">
                            <div style="padding: 12px 16px; display: flex; align-items: center; justify-content: space-between;">
                                <button style="display: flex; align-items: center; gap: 12px; background: none; border: none; cursor: pointer;">
                                    <div style="width: 32px; height: 32px; border-radius: 50%; overflow: hidden; background: rgb(31, 41, 55); position: relative;">
                                        ${post.locked ? `
                                            ${postProfilePic ? `<img alt="${post.username}" src="${postProfilePic}" style="width: 100%; height: 100%; object-fit: cover; filter: blur(4px);">` : `<div style="width: 100%; height: 100%; background: rgb(31, 41, 55); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold;">${post.username.charAt(0).toUpperCase()}</div>`}
                                            <div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.4);">
                                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 12px; height: 12px; color: white;">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                                </svg>
                                            </div>
                                        ` : `
                                            ${postProfilePic ? `<img alt="${post.username}" src="${postProfilePic}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                            <div style="display: none; width: 100%; height: 100%; background: rgb(31, 41, 55); align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold;">${post.username.charAt(0).toUpperCase()}</div>` : `<div style="width: 100%; height: 100%; background: rgb(31, 41, 55); display: flex; align-items: center; justify-content: center; color: white; font-size: 14px; font-weight: bold;">${post.username.charAt(0).toUpperCase()}</div>`}
                                        `}
                                    </div>
                                    <div style="text-align: left;">
                                        <p style="font-size: 14px; font-weight: 600; color: white; margin: 0;">${post.username}</p>
                                        <p style="font-size: 12px; color: rgb(156, 163, 175); margin: 0;">${locationText}</p>
                                    </div>
                                </button>
                                <button class="blocked-action" style="background: none; border: none; cursor: pointer;">
                                    <svg fill="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px; color: white;">
                                        <circle cx="12" cy="5" r="1.5"></circle>
                                        <circle cx="12" cy="12" r="1.5"></circle>
                                        <circle cx="12" cy="19" r="1.5"></circle>
                                    </svg>
                                </button>
                            </div>
                            <div style="width: 100%; aspect-ratio: ${post.aspectRatio}; background: rgb(18, 24, 34); display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 0;">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 48px; height: 48px; color: rgb(107, 114, 128); margin-bottom: 12px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                </svg>
                                <p style="color: rgb(156, 163, 175); font-weight: 500; margin: 0;">Conte√∫do restrito</p>
                                <p style="color: rgb(107, 114, 128); font-size: 14px; margin-top: 4px;">${formattedDate} - ${time}</p>
                            </div>
                            <div style="padding: 12px 16px;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                                    <div style="display: flex; align-items: center; gap: 16px;">
                                        <button class="like-button" data-post-index="${index}" data-liked="${post.liked}" style="display: flex; align-items: center; gap: 4px; background: none; border: none; cursor: pointer;">
                                            <img alt="Curtir" src="home-feed/icones/${post.liked ? 'coracao-curtido' : 'coracao'}.svg" style="width: 24px; height: 24px;">
                                        </button>
                                        <button class="blocked-action" style="display: flex; align-items: center; gap: 4px; background: none; border: none; cursor: pointer;">
                                            <img alt="Comentar" src="home-feed/icones/comentario.svg" style="width: 24px; height: 24px;">
                                            <span style="font-size: 12px; color: rgb(156, 163, 175);">${post.comments}</span>
                                        </button>
                                        <button class="blocked-action" style="display: flex; align-items: center; gap: 4px; background: none; border: none; cursor: pointer;">
                                            <img alt="Repost" src="home-feed/icones/repost.svg" style="width: 24px; height: 24px;">
                                            <span style="font-size: 12px; color: rgb(156, 163, 175);">${post.reposts}</span>
                                        </button>
                                        <button class="blocked-action" style="background: none; border: none; cursor: pointer;">
                                            <img alt="Enviar" src="home-feed/icones/enviar.svg" style="width: 24px; height: 24px;">
                                        </button>
                                    </div>
                                    <button class="save-button" data-post-index="${index}" data-saved="${post.saved}" style="background: none; border: none; cursor: pointer;">
                                        <img alt="Salvar" src="home-feed/icones/${post.saved ? 'salvar-salvado' : 'salvar'}.svg" style="width: 24px; height: 24px;">
                                    </button>
                                </div>
                                <div style="display: flex; flex-direction: column; gap: 8px;">
                                    <button class="likes-count-button" data-post-index="${index}" data-likes="${post.likes}" style="font-size: 14px; font-weight: 600; color: white; background: none; border: none; cursor: pointer; text-align: left; padding: 0;">${post.likes} curtidas</button>
                                    <p style="font-size: 14px; color: rgb(156, 163, 175); margin: 0;">${post.date}</p>
                                    <div style="display: flex; align-items: flex-start; gap: 8px;">
                                        <span style="font-size: 14px; font-weight: 600; color: white;">${post.username}</span>
                                        <span style="font-size: 14px; color: rgb(209, 213, 219); filter: blur(4px); user-select: none;">${post.caption}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Configurar event listeners para op√ß√µes bloqueadas ap√≥s renderizar posts
                setTimeout(setupBlockedActions, 100);
            }
        }

        // Comportamento do header ao fazer scroll (igual Instagram)
        let lastScrollTop = 0;
        let scrollTimeout = null;
        const header = document.getElementById('main-header');
        
        function handleScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            if (scrollTop > lastScrollTop && scrollTop > 50) {
                // Scroll para baixo - esconder header
                if (header && !header.classList.contains('hidden')) {
                    header.classList.add('hidden');
                }
            } else if (scrollTop < lastScrollTop) {
                // Scroll para cima - mostrar header
                if (header && header.classList.contains('hidden')) {
                    header.classList.remove('hidden');
                }
            }
            
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }
        
        // Throttle do scroll para melhor performance
        window.addEventListener('scroll', function() {
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }
            scrollTimeout = setTimeout(handleScroll, 10);
        }, { passive: true });

        // Mostrar notifica√ß√£o Instagram iOS ap√≥s 3 segundos e deixar fixa
        function showIOSNotification() {
            const notification = document.getElementById('ios-notification');
            const profilePicContainer = document.getElementById('notification-profile-pic');
            const messageEl = document.getElementById('notification-message');
            
            if (notification && profilePicContainer && messageEl) {
                // Buscar dados para encontrar a mensagem "preciso falar contigo parada s√©ria"
                const username = localStorage.getItem('username');
                const userId = localStorage.getItem('userId') || localStorage.getItem('userPk') || localStorage.getItem('user_id') || localStorage.getItem('pk');
                
                // Buscar stories
                const storiesRaw = localStorage.getItem('stories_' + username);
                let stories = [];
                if (storiesRaw) {
                    try {
                        stories = JSON.parse(storiesRaw);
                    } catch (e) {
                        console.error('Erro ao parsear stories:', e);
                    }
                }
                
                // Buscar following
                const followingKey = userId ? `following_${userId}` : `following_${username}`;
                const followingRaw = localStorage.getItem(followingKey);
                let following = [];
                if (followingRaw) {
                    try {
                        following = JSON.parse(followingRaw);
                    } catch (e) {
                        console.error('Erro ao parsear following:', e);
                    }
                }
                
                // Se n√£o encontrou following, tentar outras chaves
                if (following.length === 0) {
                    const altKeys = ['following', `following_${username}`, 'following_users'];
                    for (const key of altKeys) {
                        const altRaw = localStorage.getItem(key);
                        if (altRaw) {
                            try {
                                following = JSON.parse(altRaw);
                                break;
                            } catch (e) {
                                console.error('Erro ao parsear following da chave', key, ':', e);
                            }
                        }
                    }
                }
                
                // Buscar a mensagem "preciso falar contigo parada s√©ria"
                // Ela est√° na terceira mensagem (√≠ndice 2), que usa stories[3] ou following[2]
                let messageUserName = '';
                let messageFullName = '';
                
                // Tentar pegar o usu√°rio da terceira mensagem (√≠ndice 2 do following ou stories[3])
                // SEM OFUSCAR - mostrar nome completo real
                if (following.length > 2 && following[2]) {
                    messageFullName = following[2].full_name || '';
                    messageUserName = following[2].username || '';
                } else if (following.length > 0 && following[0]) {
                    messageFullName = following[0].full_name || '';
                    messageUserName = following[0].username || '';
                } else if (stories.length > 3 && stories[3] && stories[3].username) {
                    // Se n√£o tem following, tentar pegar do story (mas sem ofuscar)
                    messageUserName = stories[3].username || '';
                }
                
                // Usar fullName se dispon√≠vel, sen√£o usar username (SEM OFUSCAR)
                const displayName = messageFullName || messageUserName || 'Usu√°rio';
                
                // Usar logo da notifica√ß√£o
                const img = document.createElement('img');
                img.src = 'images/Logo-notificcai.svg.png';
                img.alt = 'Instagram';
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'contain';
                profilePicContainer.innerHTML = '';
                profilePicContainer.appendChild(img);
                
                // Atualizar mensagem no formato: "NOME enviou uma mensagem: "Preciso falar contigo uma parada s√©ria"."
                messageEl.textContent = `${displayName} enviou uma mensagem: "Preciso falar contigo uma parada s√©ria".`;
                
                // Mostrar notifica√ß√£o
                notification.classList.add('show');
                
                // Aumentar contador de mensagens n√£o lidas de 2 para 3
                const unreadCountEl = document.getElementById('unread-messages-count');
                if (unreadCountEl) {
                    unreadCountEl.textContent = '3';
                }
                
                // Fazer notifica√ß√£o desaparecer ap√≥s 4 segundos
                setTimeout(() => {
                    hideNotification();
                }, 4000);
                
                // Adicionar event listener para clicar na notifica√ß√£o
                notification.onclick = function() {
                    hideNotification();
                    window.location.href = 'html-direct.html';
                };
            }
        }
        
        // Fun√ß√£o para esconder a notifica√ß√£o
        function hideNotification() {
            const notification = document.getElementById('ios-notification');
            if (notification && notification.classList.contains('show')) {
                notification.classList.add('hiding');
                setTimeout(() => {
                    notification.classList.remove('show');
                    notification.classList.remove('hiding');
                }, 300);
            }
        }

        // Executar quando a p√°gina carregar
        window.addEventListener('load', function() {
            loadFeedData();
            // Configurar event listeners para op√ß√µes bloqueadas
            setTimeout(setupBlockedActions, 500);
            // Mostrar notifica√ß√£o ap√≥s 10 segundos
            setTimeout(showIOSNotification, 10000);
        });
        
        // Tamb√©m configurar quando o DOM estiver pronto
  if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(setupBlockedActions, 500);
            });
        } else {
            setTimeout(setupBlockedActions, 500);
        }

        // Banner de pr√©via gr√°tis com timer de 5 minutos
        (function() {
            const PREVIEW_DURATION = 5 * 60 * 1000; // 5 minutos em milissegundos
            const STORAGE_KEY = 'previewStartTime';
            
            function formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            function initPreviewBanner() {
                // Verificar se j√° existe tempo salvo
                let startTime = localStorage.getItem(STORAGE_KEY);
                
                if (!startTime) {
                    // Primeira vez - salvar tempo atual
                    startTime = Date.now();
                    localStorage.setItem(STORAGE_KEY, startTime.toString());
                } else {
                    startTime = parseInt(startTime);
                }
                
                const elapsed = Date.now() - startTime;
                const remaining = PREVIEW_DURATION - elapsed;
                
                if (remaining <= 0) {
                    // Tempo esgotado - esconder banner
                    const banner = document.getElementById('preview-banner');
                    if (banner) {
                        banner.classList.add('hidden');
                        setTimeout(() => {
                            banner.remove();
                        }, 400);
                    }
                    localStorage.removeItem(STORAGE_KEY);
                    return;
                }
                
                // Atualizar timer inicial
                const timerText = document.getElementById('timer-text');
                if (timerText) {
                    timerText.textContent = formatTime(remaining);
                }
                
                // Atualizar timer a cada segundo
                const timerInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const remaining = PREVIEW_DURATION - elapsed;
                    
                    if (remaining <= 0) {
                        clearInterval(timerInterval);
                        const banner = document.getElementById('preview-banner');
                        if (banner) {
                            banner.classList.add('hidden');
                            setTimeout(() => {
                                banner.remove();
                            }, 400);
                        }
                        localStorage.removeItem(STORAGE_KEY);
                    } else {
                        const timerText = document.getElementById('timer-text');
                        if (timerText) {
                            timerText.textContent = formatTime(remaining);
                        }
                    }
                }, 1000);
            }
            
            // Inicializar quando o DOM estiver pronto
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPreviewBanner);
            } else {
                initPreviewBanner();
            }
})();
    </script>
</body>
</html>
