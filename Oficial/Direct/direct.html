<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8">
    <title>In'Stalker - O maior software de espionagem de Instagram da Am√©rica Latina</title>
    <meta name="description" content="In'Stalker - O maior software de espionagem de Instagram da Am√©rica Latina">
    <link rel="shortcut icon" href="/images/icon-site.png">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon" sizes="16x16">
    <link rel="icon" href="/images/icon-site.png">
    <link rel="apple-touch-icon" href="/images/icon-site.png">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="direct-new.css">
    <script src="../js/geral.js"></script>
    <!-- SVG Symbols para √≠cones reutiliz√°veis -->
    <svg style="display: none;">
        <symbol id="camera-icon" viewBox="0 0 66 64" fill="none">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M24.743 0.806959C22.974 1.01696 20.854 2.54296 18.826 5.06696C16.383 8.10696 14.966 9.00096 12.583 9.00396C10.887 9.00596 8.01 9.91596 6.19 11.026C0.838 14.289 0 17.748 0 36.582C0 51.783 0.187 53.561 2.159 57.069C5.68 63.333 8.651 64 33.052 64C55.815 64 58.402 63.529 63 58.551C65.45 55.898 65.506 55.477 65.811 37.491C66.071 22.148 65.858 18.626 64.513 16.024C62.544 12.217 57.524 9.00896 53.527 9.00396C51.336 9.00096 49.627 7.96696 47.027 5.07196C43.551 1.19996 43.384 1.13796 35.5 0.811961C31.1 0.629961 26.259 0.627959 24.743 0.806959ZM43.216 9.57496C44.622 12.66 48.789 15 52.878 15C54.903 15 56.518 15.843 57.927 17.635C59.831 20.055 60 21.594 60 36.524C60 59.297 62.313 57.5 33.052 57.5C3.655 57.5 6 59.35 6 36.204C6 20.562 6.122 19.499 8.174 17.314C9.469 15.936 11.511 15 13.224 15C17.15 15 21.289 12.696 22.954 9.58496C24.282 7.10396 24.693 6.99996 33.19 6.99996C41.731 6.99996 42.084 7.09096 43.216 9.57496ZM27 19.722C15.76 23.945 13.183 40.493 22.611 47.908C30.698 54.27 42.974 51.753 47.612 42.783C51.201 35.844 48.564 25.701 42.015 21.25C38.771 19.046 30.925 18.247 27 19.722ZM40.077 27.923C46.612 34.459 42.201 45.273 33 45.273C23.799 45.273 19.388 34.459 25.923 27.923C30.039 23.807 35.961 23.807 40.077 27.923Z" fill="#F9F9F9"></path>
        </symbol>
    </svg>
    <style>
        /* Estilos para Chat N√£o Lido */
        .chat-item.chat-unread .chat-camera-icon {
            opacity: 1 !important;
        }
        
        .chat-item.chat-unread .chat-name {
            font-weight: bold !important;
        }
        
        .chat-item.chat-unread .chat-message-text {
            color: #F9F9F9 !important;
            font-weight: bold !important;
        }
        
        /* Aumentar espa√ßamento entre nome e mensagem apenas (n√£o entre chats) */
        .chat-message-row {
            margin-top: 3px !important;
        }
        
        /* Aplicar blur em todas as imagens chat-photo com overflow para ultrapassar um pouco o c√≠rculo */
        .chat-avatar-wrapper:not(.locked-avatar) {
            overflow: visible !important;
            position: relative !important;
        }
        
        /* Centralizar SVG do cadeado sobre a imagem (apenas em chats n√£o locked) */
        .chat-avatar-wrapper:not(.locked-avatar) > svg {
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 2 !important;
            pointer-events: none !important;
        }
        
        .chat-avatar-wrapper:not(.locked-avatar) .chat-photo {
            filter: blur(5px) !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        /* Aplicar blur no SVG do cadeado dos chats locked (mesmo estilo dos outros) */
        .chat-avatar-container {
            position: relative !important;
        }
        
        /* Estilo compartilhado para todos os cadeados */
        .chat-avatar-wrapper svg,
        .chat-lock-icon svg {
            stroke: #F9F9F9 !important;
            opacity: 0.8 !important;
            filter: drop-shadow(0 0 6px rgba(0, 0, 0, 1)) !important;
        }
        
        .chat-lock-icon {
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            z-index: 2 !important;
            pointer-events: none !important;
            overflow: visible !important;
        }
        
        .chat-avatar-wrapper.locked-avatar {
            overflow: visible !important;
            position: relative !important;
            filter: blur(5px) !important;
        }
        
        /* Garantir espa√ßamento correto entre chats */
        .chat-item {
            padding: 12px 0 !important;
        }
    </style>
</head>
<body class="__variable_8b3a0b font-inter antialiased">
    <div class="min-h-screen bg-[#0B1014] relative overflow-x-hidden" 
         style="font-family: &quot;Arbitare Sans&quot;, -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif;">
        
        <!-- Header -->
        <div class="flex items-center justify-between px-4 py-3 border-b border-gray-800" style="position: fixed; top: 0; left: 0; right: 0; background-color: #0B1014; z-index: 50;">
            <div class="flex items-center space-x-3">
                <button class="p-1 transition-colors" aria-label="Voltar" id="backButton" style="background: none; border: none; cursor: pointer;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#F9F9F9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M15 18l-6-6 6-6"></path>
                    </svg>
                </button>
                <h1 style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 20px; color: rgb(249, 249, 249); font-weight: 600; letter-spacing: -0.3px;">andre.menegon</h1>
            </div>
            <div class="flex items-center space-x-4">
                <svg width="24" height="24" viewBox="0 0 69 69" fill="none">
                    <path fill-rule="evenodd" clip-rule="evenodd" d="M30.8471 0.558896C27.5641 1.4949 25.7521 3.6039 19.6111 13.6319C17.4081 17.2299 15.3201 19.0549 10.7811 21.3459C7.51206 22.9959 3.92306 25.5089 2.80506 26.9299C-2.18494 33.2729 -0.395945 40.6819 7.20506 45.1619C16.6311 50.7169 18.1311 52.0689 21.3811 57.9379C25.9281 66.1469 28.6881 68.4199 34.1131 68.4199C39.7151 68.4199 43.4841 65.3589 47.7611 57.3319C50.5401 52.1179 51.8141 50.8849 58.1341 47.2889C65.8431 42.9029 68.6341 39.4949 68.6341 34.4659C68.6341 29.1849 66.2281 26.1259 58.4791 21.5519C51.9381 17.6909 50.6991 16.4519 47.1581 10.2269C42.1781 1.4739 37.4551 -1.3261 30.8471 0.558896ZM41.2421 12.4199C45.1841 19.3819 49.6631 23.8629 56.6341 27.8189C61.6411 30.6609 62.1341 31.2509 62.1341 34.4039C62.1341 37.6079 61.6531 38.1459 55.6941 41.6109C47.6871 46.2669 46.2451 47.7059 41.6841 55.5939C38.3161 61.4189 37.7551 61.9199 34.6011 61.9199C31.8761 61.9199 30.7941 61.3069 29.3111 58.9199C21.8511 46.9169 21.0491 46.0149 14.8281 42.6199C11.3601 40.7279 7.82105 38.1079 6.96305 36.7999C5.56105 34.6599 5.55806 34.1839 6.93406 32.0839C7.77606 30.7989 11.5491 27.9159 15.3181 25.6769C21.4241 22.0489 22.6481 20.7729 26.5451 13.9609C30.8301 6.4719 30.9931 6.3219 34.5231 6.6179C37.7361 6.8869 38.4661 7.5179 41.2421 12.4199ZM22.9431 26.0559C21.4701 29.8949 26.7831 32.7159 28.9671 29.2539C29.7301 28.0449 29.6571 27.1529 28.7041 26.0039C26.9931 23.9429 23.7431 23.9719 22.9431 26.0559ZM40.0181 25.8619C38.9531 28.6369 40.0901 30.9199 42.5391 30.9199C45.6931 30.9199 47.4801 28.1439 45.7041 26.0039C44.0621 24.0259 40.7541 23.9429 40.0181 25.8619ZM40.0651 37.4749C36.5741 39.7759 31.7631 39.9849 29.0751 37.9519C28.0081 37.1439 26.0901 36.4689 24.8141 36.4519C22.9831 36.4269 22.5621 36.8859 22.8141 38.6359C23.3121 42.0869 29.1181 45.4199 34.6341 45.4199C42.3761 45.4199 49.6601 39.1099 44.8751 36.5489C43.4611 35.7919 42.2691 36.0219 40.0651 37.4749Z" fill="#F9F9F9"></path>
                </svg>
                <svg aria-label="Nova mensagem" fill="#F9F9F9" height="24" role="img" viewBox="0 0 24 24" width="24">
                    <title>Nova mensagem</title>
                    <path d="M12.202 3.203H5.25a3 3 0 0 0-3 3V18.75a3 3 0 0 0 3 3h12.547a3 3 0 0 0 3-3v-6.952" fill="none" stroke="#F9F9F9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                    <path d="M10.002 17.226H6.774v-3.228L18.607 2.165a1.417 1.417 0 0 1 2.004 0l1.224 1.225a1.417 1.417 0 0 1 0 2.004Z" fill="none" stroke="#F9F9F9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                    <line fill="none" stroke="#F9F9F9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" x1="16.848" x2="20.076" y1="3.924" y2="7.153"></line>
                </svg>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="px-4" style="padding-top: 68.4px; padding-bottom: 0px;">
            <div class="relative">
                <div class="absolute left-3 w-5 h-5" style="top: 11px;">
                    <div style="width: 20px; height: 20px;">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" width="500" height="500" preserveAspectRatio="xMidYMid meet" style="width: 100%; height: 100%; transform: translate3d(0px, 0px, 0px); content-visibility: visible;">
                            <defs>
                                <clipPath id="__lottie_element_2"><rect width="500" height="500" x="0" y="0"></rect></clipPath>
                                <g id="__lottie_element_3">
                                    <g transform="matrix(1,0,0,1,217,229)" opacity="1" style="display: block;">
                                        <g opacity="1" transform="matrix(1,0,0,1,33,21)">
                                            <path stroke-linecap="butt" stroke-linejoin="miter" fill-opacity="0" stroke-miterlimit="4" stroke="rgb(101,101,101)" stroke-opacity="1" stroke-width="80" d=" M107.43711853027344,-123.74400329589844 C137.5516815185547,-89.05899810791016 165.66978454589844,-50.757450103759766 168.593994140625,2.0230000019073486 C170.96469116210938,46.05605697631836 157.39999389648438,90.08799743652344 123.74400329589844,123.74400329589844 C89.572998046875,157.9149932861328 44.7859992980957,175 0,175 C-44.7859992980957,175 -89.572998046875,157.9149932861328 -123.74400329589844,123.74400329589844 C-157.40899658203125,90.0790023803711 -169.7324676513672,46.09290313720703 -168.59414672851562,1.9889999628067017 C-167.37847900390625,-44.77629852294922 -146.09210205078125,-85.59001159667969 -107.43626403808594,-123.74400329589844 C-74.98016357421875,-155.78973388671875 -38.30464172363281,-175.2530059814453 0.8683412075042725,-174.9969940185547 C39.4625244140625,-174.7449951171875 77.98967742919922,-157.66099548339844 107.43711853027344,-123.74400329589844z"></path>
                                        </g>
                                    </g>
                                </g>
                                <linearGradient id="__lottie_element_9" spreadMethod="pad" gradientUnits="userSpaceOnUse" x1="-179.9929962158203" y1="-7.324999809265137" x2="200.80799865722656" y2="8.270000457763672">
                                    <stop offset="1%" stop-color="rgb(250,17,247)"></stop>
                                    <stop offset="18%" stop-color="rgb(135,30,234)"></stop>
                                    <stop offset="52%" stop-color="rgb(19,43,221)"></stop>
                                    <stop offset="85%" stop-color="rgb(15,124,238)"></stop>
                                    <stop offset="99%" stop-color="rgb(11,206,255)"></stop>
                                </linearGradient>
                                <mask id="__lottie_element_3_1" mask-type="alpha"><use xlink:href="#__lottie_element_3"></use></mask>
                            </defs>
                            <g clip-path="url(#__lottie_element_2)">
                                <g mask="url(#__lottie_element_3_1)" style="display: block;">
                                    <g transform="matrix(0.28873103857040405,0.9574102759361267,-0.9574102759361267,0.28873103857040405,260.5774841308594,212.34210205078125)" opacity="1">
                                        <g opacity="1" transform="matrix(1,0,0,1,33,21)">
                                            <path fill="url(#__lottie_element_9)" fill-opacity="1" d=" M155.36000061035156,-155.32899475097656 C198.9080047607422,-111.78099822998047 220.35499572753906,-54.500999450683594 219.69900512695312,2.572000026702881 C219.06300354003906,57.95199966430664 197.61599731445312,113.13800048828125 155.36000061035156,155.3939971923828 C112.45800018310547,198.29600524902344 56.229000091552734,219.7469940185547 -0.0010000000474974513,219.7469940185547 C-56.23099899291992,219.7469940185547 -112.46099853515625,198.29600524902344 -155.36300659179688,155.3939971923828 C-197.6300048828125,113.12699890136719 -219.0749969482422,57.92399978637695 -219.7010040283203,2.5290000438690186 C-220.34500122070312,-54.529998779296875 -198.89999389648438,-111.79199981689453 -155.36300659179688,-155.32899475097656 C-112.14199829101562,-198.5500030517578 -55.39400100708008,-220 1.253999948501587,-219.67799377441406 C57.064998626708984,-219.36099243164062 112.7770004272461,-197.91200256347656 155.36000061035156,-155.32899475097656z"></path>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
                <input placeholder="Interaja com a Meta AI ou pesquise" 
                       class="w-full pl-10 pr-3 py-2.5 rounded-full text-sm search-input" 
                       type="text" 
                       style="background-color: rgb(37, 40, 45); color: rgb(142, 147, 153); font-size: 16.5px; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; padding: 11px 12px 11px 40px;">
            </div>
        </div>

        <!-- Stories Section -->
        <div class="relative">
            <div class="flex space-x-4 stories-container scrollbar-hide overflow-x-auto" 
                 style="padding-left: 16px; padding-right: 0px; scroll-behavior: smooth; width: calc(100% + 32px);" 
                 id="storiesContainer">
                <!-- Stories ser√£o inseridos via JavaScript -->
            </div>
            <div class="absolute top-0 right-0 h-full w-8 bg-gradient-to-l from-[#0B1014] to-transparent pointer-events-none"></div>
        </div>

        <!-- Messages Header -->
        <div class="flex justify-between items-center px-4 py-3 mt-2">
            <h2 class="text-lg font-semibold" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; color: rgb(249, 249, 249); font-weight: 600;">Mensagens</h2>
            <span class="text-sm" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; color: rgb(81, 122, 255); font-weight: 400;">Pedidos (4)</span>
        </div>

        <!-- Messages List -->
        <div class="px-4 pb-16" id="messagesList">
            <!-- Chat Clic√°vel 1 -->
            <div class="chat-item chat-clickable chat-unread" data-chat-index="15">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <img class="chat-photo" src="../imagens/chat1.png" alt="" width="56" height="56">
                        </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">Fer*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Oi del√≠cia, adivinha o que vc esqueceu aqui? kkkkk</span>
                        <span class="chat-time" id="chatClickable1Time"> ‚Ä¢ Agora</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="chat-unread-dot"></div>
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- Chat Clic√°vel 2 -->
            <div class="chat-item chat-clickable" data-chat-index="16">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <img class="chat-photo" src="../imagens/chat2.png" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">And*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Reagiu com üëç √† sua mensagem</span>
                        <span class="chat-time" id="chatClickable2Time"> ‚Ä¢ 2 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- Chat Clic√°vel 3 -->
            <div class="chat-item chat-clickable chat-unread" data-chat-index="17">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <img class="chat-photo" src="../imagens/chat3.png" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">ùï≠ùñóùñö****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">4 novas mensagens</span>
                        <span class="chat-time" id="chatClickable3Time"> ‚Ä¢ Agora</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="chat-unread-dot"></div>
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- Chat Clic√°vel 4 -->
            <div class="chat-item chat-clickable" data-chat-index="18">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <img class="chat-photo" src="/proxy-image?url=https%3A%2F%2Fscontent-iad3-1.cdninstagram.com%2Fv%2Ft51.2885-19%2F529878870_17845240746542062_6238251793736528713_n.jpg%3Fstp%3Ddst-jpg_e0_s150x150_tt6%26efg%3DeyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby41NjMuYzIifQ%26_nc_ht%3Dscontent-iad3-1.cdninstagram.com%26_nc_cat%3D110%26_nc_oc%3DQ6cZ2QEuyZ_AqSuZRTtomFfilJcFORQ7zqUfh-_7rc6H_W4uyKus5fF60hDcwhyrGx0hdAI%26_nc_ohc%3D1vLTl5jIBlYQ7kNvwEhBeJ5%26_nc_gid%3D_GlnJsLWtiMIHY2eydf-Fw%26edm%3DAPQMUHMBAAAA%26ccb%3D7-5%26ig_cache_key%3DGFZPlR-uA6HjJmY-AEnzG2n0uJJWbmNDAQAB1501500j-ccb7-5%26oh%3D00_AflYRGdmq_gQT0_L2ruVnJ5BVmXBu4logeDQcynpwBGFzw%26oe%3D6934D9D4%26_nc_sid%3D6ff7c8" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">MIGUELüáßüá∑üá∫üá≤</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Preciso falar contigo parada s√©ria veiii</span>
                        <span class="chat-time" id="chatClickable4Time"> ‚Ä¢ 6 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- Chat Clic√°vel 5 -->
            <div class="chat-item chat-clickable" data-chat-index="19">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <img class="chat-photo" src="/proxy-image?url=https%3A%2F%2Fscontent-iad3-2.cdninstagram.com%2Fv%2Ft51.2885-19%2F541557238_17866458588443970_5760192610428920763_n.jpg%3Fstp%3Ddst-jpg_e0_s150x150_tt6%26efg%3DeyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby4xMDgwLmMyIn0%26_nc_ht%3Dscontent-iad3-2.cdninstagram.com%26_nc_cat%3D106%26_nc_oc%3DQ6cZ2QEuyZ_AqSuZRTtomFfilJcFORQ7zqUfh-_7rc6H_W4uyKus5fF60hDcwhyrGx0hdAI%26_nc_ohc%3Dx4coB-qlCaIQ7kNvwEokpeF%26_nc_gid%3D_GlnJsLWtiMIHY2eydf-Fw%26edm%3DAPQMUHMBAAAA%26ccb%3D7-5%26ig_cache_key%3DGPaBRyBC9Y4Nc3k-ALsjcg6pUPBPbmNDAQAB1501500j-ccb7-5%26oh%3D00_AflOvd_OJ2Ip-H-2TtvEr6KBq9X3WQXLTIpPuVExsKg0wA%26oe%3D6934D92A%26_nc_sid%3D6ff7c8" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">itzbryan</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">1 novas mensagens</span>
                        <span class="chat-time" id="chatClickable5Time"> ‚Ä¢ 6 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 3 -->
            <div class="chat-item" data-chat-index="2">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">vazou tudo kkkkk</span>
                        <span class="chat-time"> ‚Ä¢ 23 min</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 4 -->
            <div class="chat-item" data-chat-index="3">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                        </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Oi, voc√™ j√° chegou?</span>
                        <span class="chat-time"> ‚Ä¢ 47 min</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="chat-unread-dot"></div>
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 5 -->
            <div class="chat-item" data-chat-index="4">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">eii, t√° a√≠?üî•</span>
                        <span class="chat-time"> ‚Ä¢ 1 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <div class="chat-unread-dot"></div>
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 6 -->
            <div class="chat-item" data-chat-index="5">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Oii del√≠cia, perd√£o pela demora estava tomando</span>
                        <span class="chat-time"> ‚Ä¢ 3 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 7 -->
            <div class="chat-item" data-chat-index="6">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">3 novas mensagens</span>
                        <span class="chat-time"> ‚Ä¢ 7 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 8 -->
            <div class="chat-item" data-chat-index="7">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">üî•üî•</span>
                        <span class="chat-time"> ‚Ä¢ 14 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 9 -->
            <div class="chat-item" data-chat-index="8">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                        <img class="chat-photo" src="" alt="" width="56" height="56">
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name"></h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Reagiu a sua mensagem: ‚ù§Ô∏è</span>
                        <span class="chat-time"> ‚Ä¢ 22 h</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 10 -->
            <div class="chat-item locked" data-chat-index="9">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper locked-avatar">
                    </div>
                    <div class="chat-lock-icon">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Enviado segunda-feira</span>
                        <span class="chat-time"> ‚Ä¢ 1 d</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 11 -->
            <div class="chat-item locked" data-chat-index="10">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper locked-avatar">
                    </div>
                    <div class="chat-lock-icon">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Del√≠cia voc√™ üòà üòà</span>
                        <span class="chat-time"> ‚Ä¢ 2 d</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 12 -->
            <div class="chat-item locked" data-chat-index="11">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper locked-avatar">
                    </div>
                    <div class="chat-lock-icon">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Curtiu sua mensagem</span>
                        <span class="chat-time"> ‚Ä¢ 3 d</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 13 -->
            <div class="chat-item locked" data-chat-index="12">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper locked-avatar">
                    </div>
                    <div class="chat-lock-icon">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Enviado quinta-feira</span>
                        <span class="chat-time"> ‚Ä¢ 5 d</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 14 -->
            <div class="chat-item locked" data-chat-index="13">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper locked-avatar">
                    </div>
                    <div class="chat-lock-icon">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">Ah sim entendi</span>
                        <span class="chat-time"> ‚Ä¢ 1 sem</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

            <!-- CHAT 15 -->
            <div class="chat-item locked" data-chat-index="14">
                <div class="chat-avatar-container">
                    <div class="chat-avatar-wrapper locked-avatar">
                    </div>
                    <div class="chat-lock-icon">
                        <svg fill="none" stroke="#F9F9F9" viewBox="0 0 24 24" width="24" height="24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                        </svg>
                    </div>
                </div>
                <div class="chat-content">
                    <div class="chat-header">
                        <h3 class="chat-name">*****</h3>
                    </div>
                    <div class="chat-message-row">
                        <span class="chat-message-text">üòàüòà</span>
                        <span class="chat-time"> ‚Ä¢ 2 sem</span>
                    </div>
                </div>
                <div class="chat-actions">
                    <svg class="chat-camera-icon" width="19.2" height="19.2"><use href="#camera-icon"></use></svg>
                </div>
            </div>

        </div>
    </div>
<!-- Banner de pr√©via gr√°tis -->
    <div id="preview-banner">
        <div class="preview-banner-content">
            <div class="preview-banner-text">
                <p class="preview-banner-title">
                    ‚ö° Pr√©via dispon√≠vel por 
                    <span class="preview-timer-inline" id="preview-timer">
                        <span id="timer-text">5:00</span>
                        <svg class="preview-timer-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </span>
                </p>
                <p class="preview-banner-description">Voc√™ ganhou 5 minutos para testar gratuitamente nossa ferramenta, mas para liberar todas as funcionalidades e ter acesso permanente √© necess√°rio ser um membro VIP.</p>
            </div>
        </div>
        <button class="preview-banner-button" onclick="window.location.href='#'">Tornar-se VIP</button>
    </div>

    <script>
        // Banner de pr√©via gr√°tis com timer de 5 minutos
        (function() {
            const PREVIEW_DURATION = 5 * 60 * 1000; // 5 minutos em milissegundos
            const STORAGE_KEY = 'previewStartTime';
            
            function formatTime(ms) {
                const totalSeconds = Math.floor(ms / 1000);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
            
            function initPreviewBanner() {
                // Verificar se j√° existe tempo salvo
                let startTime = localStorage.getItem(STORAGE_KEY);
                
                if (!startTime) {
                    // Primeira vez - salvar tempo atual
                    startTime = Date.now();
                    localStorage.setItem(STORAGE_KEY, startTime.toString());
                } else {
                    startTime = parseInt(startTime);
                }
                
                const elapsed = Date.now() - startTime;
                const remaining = PREVIEW_DURATION - elapsed;
                
                if (remaining <= 0) {
                    // Tempo esgotado - esconder banner
                    const banner = document.getElementById('preview-banner');
                    if (banner) {
                        banner.classList.add('hidden');
                        setTimeout(() => {
                            banner.remove();
                        }, 400);
                    }
                    localStorage.removeItem(STORAGE_KEY);
                    return;
                }
                
                // Atualizar timer inicial
                const timerText = document.getElementById('timer-text');
                if (timerText) {
                    timerText.textContent = formatTime(remaining);
                }
                
                // Atualizar timer a cada segundo
                const timerInterval = setInterval(() => {
                    const elapsed = Date.now() - startTime;
                    const remaining = PREVIEW_DURATION - elapsed;
                    
                    if (remaining <= 0) {
                        clearInterval(timerInterval);
                        const banner = document.getElementById('preview-banner');
                        if (banner) {
                            banner.classList.add('hidden');
                            setTimeout(() => {
                                banner.remove();
                            }, 400);
                        }
                        localStorage.removeItem(STORAGE_KEY);
                    } else {
                        const timerText = document.getElementById('timer-text');
                        if (timerText) {
                            timerText.textContent = formatTime(remaining);
                        }
                    }
                }, 1000);
            }
            
            // Inicializar quando o DOM estiver pronto
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initPreviewBanner);
            } else {
                initPreviewBanner();
            }
        })();
    </script>

    <script>
// ============================================
// DIRECT - JAVASCRIPT INLINE (como no feed)
// ============================================

// Ajustar escala proporcional baseada no viewport width
// iPhone 12 Pro: 390px (refer√™ncia)
// Galaxy S8: 360px (precisa manter mesma propor√ß√£o visual)
// APENAS para dispositivos m√≥veis (at√© 768px)
(function adjustViewportScale() {
    const iPhone12ProWidth = 390;
    const mobileBreakpoint = 768; // Aplicar escala apenas em telas menores que 768px
    
    function calculateScale() {
        const currentWidth = window.innerWidth || document.documentElement.clientWidth;
        
        // Se for desktop (maior que 768px), n√£o aplicar escala
        if (currentWidth > mobileBreakpoint) {
            document.documentElement.style.setProperty('--viewport-scale', '1');
            document.documentElement.style.setProperty('--base-font-size', '16px');
            document.documentElement.style.fontSize = '16px';
            return;
        }
        
        // Para mobile, aplicar escala proporcional
        const scale = currentWidth / iPhone12ProWidth;
        document.documentElement.style.setProperty('--viewport-scale', scale);
        document.documentElement.style.setProperty('--base-font-size', `${16 * scale}px`);
        document.documentElement.style.fontSize = `${16 * scale}px`;
    }
    
    // Calcular na inicializa√ß√£o
    calculateScale();
    
    // Recalcular quando a janela for redimensionada
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(calculateScale, 100);
    });
})();

// Dados das mensagens (mesmas URLs do HTML original)
// Ordem: 1-liberado, 2-semi, 3-semi, 4-liberado, 5-liberado, 6-semi, 7-semi
const messagesData = [
    {
        id: 3,
        username: "m*****",
        fullName: "Maria",
        avatar: "/home - chat/fotos/chat2-1.png",
        lastMessage: "Preciso falar contigo parada s√©ria veiii",
        time: "1 min", // Chat 1
        unread: true,
        online: true,
        verified: true,
        blurred: false
        // Esta mensagem N√ÉO tem cursor-pointer no original
    },
    {
        id: 4,
        username: "w*****",
        fullName: "Wendel Da Costa Neves",
        avatar: "https://scontent-bos5-1.cdninstagram.com/v/t51.2885-19/459529566_1743818203040477_3798857640595357453_n.jpg?stp=dst-jpg_e0_s150x150_tt6&efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby42NDAuYzIifQ&_nc_ht=scontent-bos5-1.cdninstagram.com&_nc_cat=105&_nc_oc=Q6cZ2QEjKLoJBuXnSaNSc_gfuOS_coAgm1xMThwJCjV9EcSe2_XZiArhQY_C2TH3I70-cH4&_nc_ohc=uIM6IQhHkPAQ7kNvwH81P_R&_nc_gid=O8AsL33CeLi_yWSpvR6CgA&edm=ALB854YBAAAA&ccb=7-5&ig_cache_key=GF7dYxvdiotQ-jEGAA3-9pvlQLg0bkULAAAB1501500j-ccb7-5&oh=00_Afim4jq-atzoTaGwdRMXXsDkha54zDXyTymfxNUC0exfgA&oe=6923AFC7&_nc_sid=ce9561",
        lastMessage: "1 novas mensagens",
        time: "8 min", // Chat 2
        unread: false,
        online: false,
        verified: false,
        blurred: true
    },
    {
        id: 6,
        username: "l*****",
        fullName: "Lucas Barbosa",
        avatar: "https://scontent-bos5-1.cdninstagram.com/v/t51.2885-19/431606186_1098948041527091_1058969948976854147_n.jpg?stp=dst-jpg_e0_s150x150_tt6&efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby4xMDgwLmMyIn0&_nc_ht=scontent-bos5-1.cdninstagram.com&_nc_cat=111&_nc_oc=Q6cZ2QEjKLoJBuXnSaNSc_gfuOS_coAgm1xMThwJCjV9EcSe2_XZiArhQY_C2TH3I70-cH4&_nc_ohc=PYh88QtuFoYQ7kNvwFV46Si&_nc_gid=O8AsL33CeLi_yWSpvR6CgA&edm=ALB854YBAAAA&ccb=7-5&ig_cache_key=GKrJuRkzT6THfOcDAIM0lNSON7IObkULAAAB1501500j-ccb7-5&oh=00_AfiTswi4DeSL3QZEL16F2S-eIfEmJzr7AyH0YBfadLTUxw&oe=6923AD93&_nc_sid=ce9561",
        lastMessage: "vazou tudo kkkkk",
        time: "23 min", // Chat 3
        unread: false,
        online: false,
        verified: false,
        blurred: true
    },
    {
        id: 1,
        username: "l*****",
        fullName: "Lucas",
        avatar: "/home - chat/fotos/chat1.png",
        lastMessage: "Oi, voc√™ j√° chegou?",
        time: "47 min", // Chat 4
        unread: true,
        online: true,
        verified: true,
        blurred: false
    },
    {
        id: 2,
        username: "j*****",
        fullName: "Jo√£o",
        avatar: "/home - chat/fotos/chat2.png",
        lastMessage: "eii, t√° a√≠?üî•",
        time: "1 h", // Chat 5
        unread: true,
        online: false,
        verified: true,
        blurred: false
    },
    {
        id: 7,
        username: "r*****",
        fullName: "Rodrigo Lemes",
        avatar: "https://scontent-bos5-1.cdninstagram.com/v/t51.2885-19/532546559_18292084498251273_1715336688088979303_n.jpg?stp=dst-jpg_e0_s150x150_tt6&efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby4xMDgwLmMyIn0&_nc_ht=scontent-bos5-1.cdninstagram.com&_nc_cat=109&_nc_oc=Q6cZ2QEjKLoJBuXnSaNSc_gfuOS_coAgm1xMThwJCjV9EcSe2_XZiArhQY_C2TH3I70-cH4&_nc_ohc=Tvuu4jtS5cgQ7kNvwFNNN90&_nc_gid=O8AsL33CeLi_yWSpvR6CgA&edm=ALB854YBAAAA&ccb=7-5&ig_cache_key=GP8Dvh8JPrjOjfxAAGcXvSuhGc4XbmNDAQAB1501500j-ccb7-5&oh=00_AfgovyzpiTfCsxs8DaLvfGjztSQSLXVINM-uaqLLKc6uNA&oe=6923ACED&_nc_sid=ce9561",
        lastMessage: "Oii del√≠cia, perd√£o pela demora estava tomando",
        time: "3 h", // Chat 6
        unread: false,
        online: true,
        verified: false,
        blurred: true
    },
    {
        id: 8,
        username: "m*****",
        fullName: "marcelo rici",
        avatar: "https://scontent-bos5-1.cdninstagram.com/v/t51.2885-19/543662182_17919118383119832_1644257086702263408_n.jpg?stp=dst-jpg_e0_s150x150_tt6&efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby44MjguYzIifQ&_nc_ht=scontent-bos5-1.cdninstagram.com&_nc_cat=100&_nc_oc=Q6cZ2QEjKLoJBuXnSaNSc_gfuOS_coAgm1xMThwJCjV9EcSe2_XZiArhQY_C2TH3I70-cH4&_nc_ohc=vPWZM_8z3xQQ7kNvwGJIQ9d&_nc_gid=O8AsL33CeLi_yWSpvR6CgA&edm=ALB854YBAAAA&ccb=7-5&ig_cache_key=GGagZyDY-endV6k-AHCcTtQbk9EWbmNDAQAB1501500j-ccb7-5&oh=00_AfgCBzSZcYGe1fMXYYZMuWChW5xAjaJwWn383MGK8_ErRA&oe=69239D99&_nc_sid=ce9561",
        lastMessage: "3 novas mensagens",
        time: "7 h", // Chat 7
        unread: false,
        online: false,
        verified: false,
        blurred: true
    },
    {
        id: 9,
        username: "i*****",
        fullName: "Igor Belasque de Castro",
        avatar: "https://scontent-bos5-1.cdninstagram.com/v/t51.2885-19/453850189_1049609309862107_3241352671746022878_n.jpg?stp=dst-jpg_e0_s150x150_tt6&efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby44MjguYzIifQ&_nc_ht=scontent-bos5-1.cdninstagram.com&_nc_cat=111&_nc_oc=Q6cZ2QEjKLoJBuXnSaNSc_gfuOS_coAgm1xMThwJCjV9EcSe2_XZiArhQY_C2TH3I70-cH4&_nc_ohc=CDuvAiyzm8gQ7kNvwFjGALu&_nc_gid=O8AsL33CeLi_yWSpvR6CgA&edm=ALB854YBAAAA&ccb=7-5&ig_cache_key=GE00DRvbOBE2nboDAN5dL98UmfssbkULAAAB1501500j-ccb7-5&oh=00_AfgEqwCmnFAOTMMqzBteDcnD3hrKFigH9wPJD1M69bs-Og&oe=6923AE17&_nc_sid=ce9561",
        lastMessage: "üî•üî•",
        time: "14 h", // Chat 8 - mais recente (aparece primeiro)
        unread: false,
        online: false,
        verified: false,
        blurred: true
        // Este √© semi-liberado (blurred mas n√£o locked), ent√£o usa foto da API
    },
    {
        id: 10,
        username: "**********",
        fullName: "**********",
        avatar: "", // Chats bloqueados NUNCA usam API
        lastMessage: "Reagiu a sua mensagem: ‚ù§Ô∏è",
        time: "22 h", // Chat 9 - mais antigo (aparece depois)
        unread: true,
        online: false,
        verified: false,
        blurred: true,
        locked: true
    },
    {
        id: 11,
        username: "**********",
        fullName: "**********",
        avatar: "", // Chats bloqueados NUNCA usam API
        lastMessage: "Enviado  X feira",
        time: "1 d", // Chat 11
        unread: false,
        online: false,
        verified: false,
        blurred: true,
        locked: true
    },
    {
        id: 12,
        username: "**********",
        fullName: "**********",
        avatar: "", // Chats bloqueados NUNCA usam API
        lastMessage: "Del√≠cia voc√™ üòà üòà",
        time: "2 d", // Chat 12
        unread: false,
        online: false,
        verified: false,
        blurred: true,
        locked: true
    },
    {
        id: 13,
        username: "**********",
        fullName: "**********",
        avatar: "", // Chats bloqueados NUNCA usam API
        lastMessage: "Curtiu sua mensagem",
        time: "3 d", // Chat 13
        unread: false,
        online: false,
        verified: false,
        blurred: true,
        locked: true
    },
    {
        id: 14,
        username: "**********",
        fullName: "**********",
        avatar: "", // Chats bloqueados NUNCA usam API
        lastMessage: "Enviado X feira",
        time: "5 d", // Chat 14
        unread: false,
        online: false,
        verified: false,
        blurred: true,
        locked: true
    },
    {
        id: 15,
        username: "**********",
        fullName: "**********",
        avatar: "", // Chats bloqueados NUNCA usam API
        lastMessage: "Ah sim entendi",
        time: "1 sem", // Chat 15
        unread: false,
        online: false,
        verified: false,
        blurred: true,
        locked: true
    }
];

// Dados dos stories (mesmas URLs do HTML original)
const storiesData = [
    {
        id: 1,
        username: "andre.menegon",
        avatar: "https://scontent-ams2-1.cdninstagram.com/v/t51.2885-19/469280503_618774417244536_6789387411220436489_n.jpg?efg=eyJ2ZW5jb2RlX3RhZyI6InByb2ZpbGVfcGljLmRqYW5nby4xMDgwLmMyIn0&_nc_ht=scontent-ams2-1.cdninstagram.com&_nc_cat=100&_nc_oc=Q6cZ2QE3PDz7pXVIHKpeFgw--_2C2I_TRcHcs0G6hdkT2CRs3WsQ6SEHVsjLx0FS36HxO3c&_nc_ohc=MuL8LYn7GsQQ7kNvwFEAnPE&_nc_gid=8nkVJHT_-bd0N7I0PA-clg&edm=AO4kU9EBAAAA&ccb=7-5&ig_cache_key=GPem_Bt4AValxTICAAmWTfjgvzhebkULAAAB0j-ccb7-5&oh=00_Afh3pBPqPiniHhkxnIBsDWWnCX63firRAGmiClTNqv9Mtw&oe=6923BAB4&_nc_sid=164c1d",
        label: "Conte as novidades",
        blurred: false,
        isOwn: true
    },
    {
        id: 2,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 3,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 4,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 5,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 6,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 7,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 8,
        username: "**********",
        avatar: "", // Stories bloqueados n√£o usam API
        label: "",
        blurred: true,
        is_locked: true
    },
    {
        id: 11,
        username: "Marc*******",
        avatar: "../imagens/playboy.jpg",
        label: "üìçüí¶ CIDADE VIZINHA DO IP",
        blurred: true
    }
];


// Fun√ß√£o para obter URL da imagem (usa proxy como no feed)
function maskFullName(fullName) {
    if (!fullName) return '';
    
    // Limpar e normalizar o nome (manter emojis e caracteres especiais v√°lidos)
    let cleanName = fullName.trim();
    
    // Remover "@" se vier no in√≠cio (caso venha como "@username")
    cleanName = cleanName.replace(/^@+/, '');
    
    // Remover apenas caracteres de controle problem√°ticos (0x00-0x1F, 0x7F-0x9F)
    // MAS MANTER emojis e caracteres Unicode v√°lidos
    // Usar uma regex mais espec√≠fica para remover apenas caracteres de controle, n√£o emojis
    cleanName = cleanName.replace(/[\u0000-\u001F\u007F-\u009F]/g, '');
    
    // MANTER o case original (n√£o transformar em mai√∫scula)
    // Pegar apenas o primeiro nome (primeira palavra)
    // Usar regex para separar por espa√ßos, mantendo emojis
    const parts = cleanName.split(/\s+/);
    const firstName = parts[0] || cleanName;
    
    if (!firstName) return '';
    
    // Contar caracteres (incluindo emojis) - usar Array.from para contar corretamente
    // Isso trata emojis como um √∫nico caractere
    const charArray = Array.from(firstName);
    const totalLength = charArray.length;
    
    // Se tiver 3 caracteres ou menos, mostrar todas com asteriscos
    if (totalLength <= 3) {
        return firstName + '******';
    }
    
    // Calcular 70% do nome vis√≠vel (30% oculto com asteriscos)
    // Exemplo: "Miguel" (6 caracteres) -> mostrar 70% = 4 caracteres -> "Migu******" (2 ocultos = 33%)
    // Exemplo: "Miguelüáßüá∑" (8 caracteres) -> mostrar 70% = 5-6 caracteres -> "Miguel******" (2-3 ocultos = 25-37%)
    // Garantir que sempre oculta pelo menos 30%
    let lettersToShow = Math.floor(totalLength * 0.7);
    
    // Garantir m√≠nimo de 3 caracteres vis√≠veis
    lettersToShow = Math.max(3, lettersToShow);
    
    // Garantir que n√£o mostra mais que 70% (sempre oculta pelo menos 30%)
    if (lettersToShow >= totalLength) {
        lettersToShow = Math.max(3, Math.floor(totalLength * 0.7));
    }
    
    // CORTAR o nome mantendo emojis e case original
    // IMPORTANTE: N√£o cortar emojis no meio
    // Flags s√£o compostas por 2 Regional Indicator Symbols (üáßüá∑ = üáß + üá∑)
    // Se o √∫ltimo caractere vis√≠vel for um Regional Indicator Symbol, remover ele para n√£o quebrar a flag
    let visiblePart = charArray.slice(0, lettersToShow).join('');
    
    // Verificar se o √∫ltimo caractere vis√≠vel √© um Regional Indicator Symbol (U+1F1E6 a U+1F1FF)
    // Se for, significa que estamos cortando uma flag no meio, ent√£o remover o √∫ltimo caractere
    if (lettersToShow < totalLength && lettersToShow > 0) {
        const lastVisibleChar = charArray[lettersToShow - 1];
        if (lastVisibleChar) {
            const lastCharCode = lastVisibleChar.codePointAt(0);
            // Se o √∫ltimo caractere vis√≠vel √© parte de uma flag (Regional Indicator Symbol)
            // Remover ele completamente para n√£o quebrar o emoji
            if (lastCharCode >= 0x1F1E6 && lastCharCode <= 0x1F1FF) {
                visiblePart = charArray.slice(0, lettersToShow - 1).join('');
            }
        }
    }
    
    return visiblePart + '******';
}

function getImageUrl(url, width = 128) {
    if (!url) return '';
    
    // Se for caminho local, usar o proxy do servidor
    if (url.startsWith('/home')) {
        return `/_next/image?url=${encodeURIComponent(url)}&w=${width}&q=75`;
    }
    
    // Para caminhos relativos de imagens locais (imagens/... dentro de Oficial)
    if (url.startsWith('imagens/') || url.startsWith('../imagens/') || url.startsWith('../../imagens/')) {
        // Manter caminho relativo para imagens dentro da pasta Oficial
        return url;
    }
    
    // Para caminhos relativos de imagens locais (images/...)
    if (url.startsWith('images/') || url.startsWith('../images/') || url.startsWith('../../images/')) {
        // Converter para caminho absoluto a partir da raiz
        const cleanPath = url.replace(/^\.\.\/\.\.\//, '').replace(/^\.\.\//, '').replace(/^images\//, 'images/');
        return `/${cleanPath}`;
    }
    
    // Para URLs do Instagram ou qualquer URL HTTPS/HTTP externa, usar proxy
    if (url && (url.includes('cdninstagram.com') || url.startsWith('http://') || url.startsWith('https://'))) {
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        
        if (isLocalhost) {
            // Ambiente local: usa localhost:8002
        const port = window.location.port || '8001';
        const apiPort = port === '8001' ? '8002' : port;
        return `http://localhost:${apiPort}/proxy-image?url=${encodeURIComponent(url)}`;
        } else {
            // Ambiente de produ√ß√£o: usar caminho relativo /proxy-image
            return `/proxy-image?url=${encodeURIComponent(url)}`;
        }
    }
    
    return url;
}

// Fun√ß√£o para gerar srcset (igual ao original)
function getSrcset(url) {
    if (!url) return '';
    
    // Gerar srcset com 1x e 2x como no original
    // Para o srcset, usar a mesma URL (o navegador escolhe a resolu√ß√£o)
    const imageUrl = getImageUrl(url, 128);
    return `${imageUrl} 1x, ${imageUrl} 2x`;
}

// Fun√ß√£o para detectar cidade por IP (igual ao feed)
let cachedCityData = null;
async function detectCityByIP() {
    if (cachedCityData) return cachedCityData;
    
    // Primeiro, tentar usar dados salvos do localStorage
    const savedLocationData = localStorage.getItem('user_location_data');
    if (savedLocationData) {
        try {
            const location = JSON.parse(savedLocationData);
            if (location.cidade && location.lat && location.lon) {
                cachedCityData = location;
                console.log('‚úÖ Usando localiza√ß√£o do cache:', location.cidade);
                return location;
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Erro ao parsear localiza√ß√£o do cache:', error);
        }
    }
    
    // Se n√£o tiver no cache, buscar agora
    const apis = [
        { url: 'https://get.geojs.io/v1/ip/geo.json', parse: (data) => ({ cidade: data.city, estado: data.region, lat: parseFloat(data.latitude), lon: parseFloat(data.longitude) }) },
        { url: 'https://ipwhois.app/json/', parse: (data) => ({ cidade: data.city, estado: data.region_code || data.region, lat: parseFloat(data.latitude), lon: parseFloat(data.longitude) }) },
        { url: 'https://freegeoip.app/json/', parse: (data) => ({ cidade: data.city, estado: data.region_code, lat: data.latitude, lon: data.longitude }) }
    ];
    
    for (const api of apis) {
        try {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            const response = await fetch(api.url, { signal: controller.signal, headers: { 'Accept': 'application/json' } });
            clearTimeout(timeoutId);
            if (!response.ok) continue;
            const data = await response.json();
            const location = api.parse(data);
            if (location.cidade && location.lat && location.lon) {
                cachedCityData = location;
                // Salvar no localStorage para pr√≥xima vez
                localStorage.setItem('user_location_data', JSON.stringify(location));
                return location;
            }
        } catch (error) {
            continue;
        }
    }
    return null;
}

// Fun√ß√£o para obter cidade vizinha (igual ao feed)
async function getNeighborCity(lat, lon, excludeCities = []) {
    if (!lat || !lon) return null;
    
    // Primeiro, tentar usar dados salvos do localStorage
    const savedNeighborCities = localStorage.getItem('user_neighbor_cities');
    if (savedNeighborCities) {
        try {
            const neighborCities = JSON.parse(savedNeighborCities);
            if (Array.isArray(neighborCities) && neighborCities.length > 0) {
                // Retornar a primeira cidade que n√£o est√° na lista de exclu√≠das
                const excludeLower = excludeCities.map(c => c.toLowerCase());
                const availableCity = neighborCities.find(city => !excludeLower.includes(city.toLowerCase()));
                if (availableCity) {
                    return availableCity;
                }
                // Se todas est√£o exclu√≠das, retornar a primeira mesmo assim
                if (neighborCities.length > 0) {
                    return neighborCities[0];
                }
            }
        } catch (error) {
            console.warn('‚ö†Ô∏è Erro ao parsear cidades vizinhas do cache:', error);
        }
    }
    
    // Se n√£o tiver no cache, buscar agora
    try {
        await new Promise(resolve => setTimeout(resolve, 1000));
        // Buscar cidades pr√≥ximas usando uma √°rea maior
        const delta = 0.3; // ~30km para ter mais op√ß√µes
        const viewbox = `${lon - delta},${lat + delta},${lon + delta},${lat - delta}`;
        const url = `https://nominatim.openstreetmap.org/search?format=json&addressdetails=1&limit=20&bounded=1&viewbox=${viewbox}&extratags=1&accept-language=pt-BR&q=${encodeURIComponent('city')}`;
        const response = await fetch(url, { headers: { 'User-Agent': 'InStalker/1.0 (contact@instalker.com)' } });
        const data = await response.json();
        if (data.length > 0) {
            // Filtrar cidades diferentes da atual e das j√° usadas
            const cityData = await detectCityByIP();
            const currentCity = cityData?.cidade?.toLowerCase();
            const excludeLower = excludeCities.map(c => c.toLowerCase());
            
            // Filtrar cidades v√°lidas (city, town, administrative) e diferentes da atual e exclu√≠das
            const validCities = data.filter(item => {
                const itemCity = item.display_name.split(',')[0].toLowerCase();
                return (item.type === 'city' || item.type === 'town' || item.type === 'administrative') && 
                       itemCity !== currentCity && 
                       !excludeLower.includes(itemCity);
            });
            
            if (validCities.length > 0) {
                return validCities[0].display_name.split(',')[0];
            }
            
            // Se n√£o encontrou nenhuma v√°lida, tentar sem filtrar exclu√≠das
            const anyNeighbor = data.find(item => {
                const itemCity = item.display_name.split(',')[0].toLowerCase();
                return (item.type === 'city' || item.type === 'town' || item.type === 'administrative') && 
                       itemCity !== currentCity;
            });
            
            if (anyNeighbor) {
                return anyNeighbor.display_name.split(',')[0];
            }
        }
    } catch (error) {
        console.error('Erro ao buscar cidade vizinha:', error);
    }
    return null;
}

// ============================================
// FUN√á√ïES AUXILIARES PARA TEMPLATES (Refatora√ß√£o)
// ============================================

// Fun√ß√£o para criar HTML de nota de m√∫sica
function createMusicNoteHTML(music, isShortTitle = false) {
    return `
        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px; width: 100%;">
            <div style="display: flex; align-items: center; gap: 6px; width: 100%; ${isShortTitle ? 'justify-content: center;' : ''}">
                <svg fill="rgb(249, 249, 249)" viewBox="0 0 24 30" width="8" height="10" style="flex-shrink: 0; color: rgb(249, 249, 249);">
                    <title>√çcone representando ondas sonoras com tr√™s barras verticais que mudam de altura de maneira pulsante</title>
                    <rect height="30" rx="2" ry="2" width="4" fill="rgb(249, 249, 249)" y="0"></rect>
                    <rect height="22" rx="2" ry="2" width="4" x="10" y="4" fill="rgb(249, 249, 249)"></rect>
                    <rect height="30" rx="2" ry="2" width="4" x="20" fill="rgb(249, 249, 249)" y="0"></rect>
                </svg>
                ${isShortTitle ? 
                    `<span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2; font-weight: bold; text-align: center;">${music.title}</span>` :
                    `<div style="overflow: hidden; white-space: nowrap; max-width: 60px; flex: 1;">
                        <span class="music-title-scroll" data-text="${music.title}" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2; font-weight: bold; display: inline-block; white-space: nowrap;">${music.title} <span style="margin-left: 20px;">${music.title}</span></span>
                    </div>`
                }
            </div>
            <span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 10px; color: rgba(255, 255, 255, 0.7); line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; width: 100%; text-align: center;">${music.artist}</span>
        </div>
    `;
}

// Fun√ß√£o para renderizar um story usando template
function renderStoryFromTemplate(storyData) {
    const template = document.getElementById('story-template');
    if (!template) {
        console.error('Template story-template n√£o encontrado');
        return null;
    }
    
    const clone = template.content.cloneNode(true);
    const button = clone.querySelector('.story-button');
    const bubble = clone.querySelector('.story-bubble');
    const bubbleContent = clone.querySelector('.story-bubble-content');
    const avatarContainer = clone.querySelector('.story-avatar-container');
    const avatar = clone.querySelector('.story-avatar');
    const avatarImg = clone.querySelector('.story-avatar-img');
    const lockOverlay = clone.querySelector('.story-lock-overlay');
    const name = clone.querySelector('.story-name');
    
    if (!button || !bubble || !bubbleContent || !avatarContainer || !avatar || !avatarImg || !lockOverlay || !name) {
        console.error('Elementos do template n√£o encontrados');
        return null;
    }
    
    // Configurar atributos
    button.setAttribute('data-story-id', storyData.id || '');
    bubble.setAttribute('data-bubble-type', storyData.isMusicNote ? 'music' : 'text');
    avatar.setAttribute('data-avatar-type', storyData.is_locked ? 'locked' : 'normal');
    lockOverlay.setAttribute('data-locked', storyData.is_locked ? 'true' : 'false');
    
    // Adicionar classe speech-bubble-music se for m√∫sica
    if (storyData.isMusicNote) {
        bubble.classList.add('speech-bubble-music');
    }
    
    // Configurar nome
    if (storyData.is_locked) {
        name.textContent = '**********';
    } else {
        name.textContent = storyData.full_name ? maskFullName(storyData.full_name) : (storyData.username || '');
    }
    
    // Configurar conte√∫do da bubble
    if (storyData.isMusicNote && storyData.music) {
        bubbleContent.innerHTML = createMusicNoteHTML(storyData.music, storyData.music.title === "APT.");
    } else {
        bubbleContent.textContent = storyData.label || '';
    }
    
    // Configurar avatar
    if (storyData.is_locked) {
        avatarImg.style.display = 'none';
    } else {
        avatarImg.src = getImageUrl(storyData.avatar || storyData.profile_pic_url, 128);
        avatarImg.alt = storyData.username || '';
    }
    
    return clone;
}

// Fun√ß√£o para renderizar uma mensagem usando template
function renderMessageFromTemplate(messageData) {
    try {
        const template = document.getElementById('message-template');
        if (!template) {
            console.error('Template message-template n√£o encontrado');
            return null;
        }
        
        const clone = template.content.cloneNode(true);
        const messageItem = clone.querySelector('.message-item');
        const avatar = clone.querySelector('.message-avatar');
        const avatarImg = clone.querySelector('.message-avatar-img');
        const lockOverlay = clone.querySelector('.message-lock-overlay');
        const onlineIndicator = clone.querySelector('.online-indicator');
        const name = clone.querySelector('.message-name');
        const text = clone.querySelector('.message-text');
        const time = clone.querySelector('.message-time');
        const unreadIndicator = clone.querySelector('.unread-indicator');
        const cameraIcon = clone.querySelector('.camera-icon');
        if (!messageItem || !avatar || !avatarImg || !lockOverlay || !onlineIndicator || !name || !text || !time || !unreadIndicator || !cameraIcon) {
            console.error('Elementos do message template n√£o encontrados');
            return null;
        }
        
        // Configurar atributos
        messageItem.setAttribute('data-message-id', messageData.id || '');
        messageItem.setAttribute('data-has-cursor', messageData.hasCursor ? 'true' : 'false');
        avatar.setAttribute('data-locked', messageData.locked ? 'true' : 'false');
        avatar.setAttribute('data-blurred', messageData.blurred ? 'true' : 'false');
        lockOverlay.setAttribute('data-locked', messageData.locked ? 'true' : 'false');
        onlineIndicator.setAttribute('data-online', messageData.online ? 'true' : 'false');
        unreadIndicator.setAttribute('data-unread', (messageData.unread && !messageData.isBlocked) ? 'true' : 'false');
        cameraIcon.setAttribute('data-blocked', messageData.isBlocked ? 'true' : 'false');
        time.setAttribute('data-show-time', messageData.showTime ? 'true' : 'false');
        
        // Verificar se √© mensagem n√£o lida (√≠cone da c√¢mera sem transpar√™ncia)
        const isBlocked = messageData.locked || messageData.blurred;
        const hasUnreadCamera = messageData.unread && !isBlocked;
        
        // Configurar opacidade do √≠cone da c√¢mera
        if (cameraIcon) {
            if (isBlocked) {
                cameraIcon.style.opacity = '0.4';
            } else if (hasUnreadCamera) {
                cameraIcon.style.opacity = '1';
            } else {
                cameraIcon.style.display = 'none';
            }
        }
        
        // Aplicar estilos para mensagens n√£o lidas: texto branco e negrito
        if (hasUnreadCamera) {
            if (name) {
                name.style.color = '#F9F9F9';
                name.style.fontWeight = '600';
            }
            if (text) {
                text.style.color = '#F9F9F9';
                text.style.fontWeight = '600';
            }
            if (time) {
                time.style.color = '#A8A8A8'; // SEMPRE cinza (cor dos chats lidos), mesmo quando n√£o lido
                time.style.fontWeight = '400'; // NUNCA negrito no tempo
            }
        }
        
        // Preencher conte√∫do
        name.textContent = messageData.displayName || '';
        text.textContent = messageData.displayMessage || '';
        if (messageData.showTime && messageData.time) {
            time.textContent = ` ‚Ä¢ ${messageData.time}`;
        }
        
        // Configurar avatar
        if (messageData.locked) {
            avatarImg.style.display = 'none';
        } else {
            avatarImg.src = getImageUrl(messageData.avatarUrl, 128);
            avatarImg.alt = messageData.displayName || '';
            avatarImg.srcset = getSrcset(messageData.avatarUrl);
        }
        
        return clone;
    } catch (error) {
        console.error('Erro ao renderizar message template:', error);
        return null;
    }
}

// Fun√ß√£o para renderizar stories (usando dados do localStorage como no feed)
function renderStories() {
    const container = document.getElementById('storiesContainer');
    if (!container) {
        console.error('DEBUG: Container storiesContainer n√£o encontrado');
        return;
    }
    

    // Obter username da URL ou localStorage (mesma l√≥gica do feed)
    const urlParams = new URLSearchParams(window.location.search);
    let username = urlParams.get('username') || localStorage.getItem('username');

    if (!username) {
        // Fallback para dados hardcoded se n√£o tiver username
    storiesData.forEach((story, index) => {
        const isLast = index === storiesData.length - 1;
        const storyElement = document.createElement('div');
        storyElement.className = `flex-shrink-0 text-center relative ${isLast ? 'pr-8' : ''} `;
        
        if (story.isOwn) {
            const ownStoryData = {
                id: story.id || 'own',
                username: story.username || '',
                full_name: story.full_name || '',
                avatar: story.avatar || '',
                label: story.label || '',
                is_locked: false,
                isMusicNote: false,
                music: null
            };
            
            const ownStoryClone = renderStoryFromTemplate(ownStoryData);
            if (ownStoryClone) {
                // Configurar conte√∫do da bubble
                const bubbleContent = ownStoryClone.querySelector('.story-bubble-content');
                if (bubbleContent) {
                    bubbleContent.innerHTML = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">${story.label}</span>`;
                }
                
                // Configurar nome
                const name = ownStoryClone.querySelector('.story-name');
                if (name) {
                    name.textContent = story.full_name ? maskFullName(story.full_name) : (story.username || '');
                }
                
                storyElement.className = `flex-shrink-0 text-center relative ${isLast ? 'pr-8' : ''}`;
                storyElement.appendChild(ownStoryClone);
            }
        } else {
                // Notas nunca t√™m blur, apenas as imagens podem ter
                
                // Conte√∫do especial para notas de m√∫sica (index 1, 4, 5, 6, 7 - stories 2, 5, 6, 7, 8)
                let noteContent = '';
                const isMusicNote = index === 1 || index === 4 || index === 5 || index === 6 || index === 7;
                
                // Array de m√∫sicas para cada story de m√∫sica
                const musicData = [
                    { title: "Cora√ß√£o Partido (Ao Vivo)", artist: "Grupo Menos √â Mais" }, // index 1 (story 2)
                    { title: "365 Dias (Vida Mansa)", artist: "MC Marks, MC Ryan SP, MC Jvila, MC Bruno MS, MC Magal" }, // index 4 (story 5) - invertido do 6
                    { title: "Oh Garota Eu Quero Voc√™ S√≥ Pra Mim", artist: "Oruam, Z√© Felipe, MC Tuto, MC Rodrigo Do CN" }, // index 5 (story 6) - invertido do 5
                    { title: "APT.", artist: "Ros√© & Bruno Mars" } // index 6 (story 7) e index 7 (story 8) - APT.
                ];
                
                if (isMusicNote) {
                    // Mapear index para posi√ß√£o no array de m√∫sicas
                    let musicIndex = 0;
                    if (index === 1) musicIndex = 0;
                    else if (index === 4) musicIndex = 1;
                    else if (index === 5) musicIndex = 2;
                    else if (index === 6 || index === 7) musicIndex = 3; // APT. para ambos
                    
                    const music = musicData[musicIndex];
                    const isShortTitle = music.title === "APT.";
                    
                    noteContent = `
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 2px; width: 100%;">
                            <div style="display: flex; align-items: center; gap: 6px; width: 100%; ${isShortTitle ? 'justify-content: center;' : ''}">
                                <svg fill="rgb(249, 249, 249)" viewBox="0 0 24 30" width="8" height="10" style="flex-shrink: 0; color: rgb(249, 249, 249);">
                                    <title>√çcone representando ondas sonoras com tr√™s barras verticais que mudam de altura de maneira pulsante</title>
                                    <rect height="30" rx="2" ry="2" width="4" fill="rgb(249, 249, 249)" y="0"></rect>
                                    <rect height="22" rx="2" ry="2" width="4" x="10" y="4" fill="rgb(249, 249, 249)"></rect>
                                    <rect height="30" rx="2" ry="2" width="4" x="20" fill="rgb(249, 249, 249)" y="0"></rect>
                                </svg>
                                ${isShortTitle ? 
                                    `<span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2; font-weight: bold; text-align: center;">${music.title}</span>` :
                                    `<div style="overflow: hidden; white-space: nowrap; max-width: 60px; flex: 1;">
                                        <span class="music-title-scroll" data-text="${music.title}" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2; font-weight: bold; display: inline-block; white-space: nowrap;">${music.title} <span style="margin-left: 20px;">${music.title}</span></span>
                                    </div>`
                                }
                            </div>
                            <span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 10px; color: rgba(255, 255, 255, 0.7); line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; width: 100%; text-align: center;">${music.artist}</span>
                        </div>
                    `;
                } else {
                    // Notas nunca t√™m blur
                    // Se for o story do Marc******* (id 11), buscar cidade vizinha do localStorage
                    if (story.id === 11) {
                        let neighborCity = null;
                        const savedNeighborCities = localStorage.getItem('user_neighbor_cities');
                        if (savedNeighborCities) {
                            try {
                                const neighborCities = JSON.parse(savedNeighborCities);
                                if (Array.isArray(neighborCities) && neighborCities.length > 0) {
                                    neighborCity = neighborCities[0];
                                }
                            } catch (error) {
                                console.warn('‚ö†Ô∏è Erro ao parsear cidades vizinhas do cache:', error);
                            }
                        }
                        const cityLabel = neighborCity ? `üìçüí¶ ${neighborCity}` : 'üìçüí¶';
                        noteContent = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">${cityLabel}</span>`;
                        
                        // Se n√£o encontrou no cache, buscar de forma ass√≠ncrona e atualizar
                        if (!neighborCity) {
                            (async () => {
                                try {
                                    const cityData = await detectCityByIP();
                                    if (cityData && cityData.lat && cityData.lon) {
                                        const fetchedNeighborCity = await getNeighborCity(cityData.lat, cityData.lon);
                                        if (fetchedNeighborCity) {
                                            const labelElement = storyElement.querySelector('.marc-story-label-fallback');
                                            if (labelElement) {
                                                labelElement.innerHTML = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">üìçüí¶ ${fetchedNeighborCity}</span>`;
                                            }
                                        }
                                    }
                                } catch (error) {
                                    console.error('DEBUG: Erro ao buscar cidade vizinha para story Marc******* (fallback):', error);
                                }
                            })();
                        }
                    } else {
                        noteContent = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">${story.label}</span>`;
                    }
                }
                
            // Stories bloqueados: foto cinza + cadeado + nome **********
            const storyAvatarHTML = story.is_locked ? `
                <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(55, 65, 81); display: block; filter: blur(2px); -webkit-filter: blur(2px);">
                    <div style="position: absolute; inset: 0; width: 100%; height: 100%; background-color: rgb(55, 65, 81);"></div>
                </div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
            ` : `
                <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(31, 41, 55); display: block;">
                    <img alt="${story.username}" src="${getImageUrl(story.avatar, 128)}" loading="eager" style="width: 100%; height: 100%; object-fit: cover; display: block; background-color: transparent; margin: 0; padding: 0;"></div>
            `;
            
            const storyNameHTML = story.is_locked ? '**********' : (story.full_name ? maskFullName(story.full_name) : (story.username || ''));
            
            storyElement.innerHTML = `
                    <button class="relative w-fit mx-auto pt-10 cursor-pointer" style="background: none; border: none; padding: 0; margin: 0; overflow: visible !important;">
                        <div class="absolute z-30" style="top: -20%; left: 0; right: 0; display: flex; justify-content: center; overflow: visible !important;">
                            <div class="relative ${isMusicNote ? '' : 'text-center'} speech-bubble ${isMusicNote ? 'speech-bubble-music' : ''}" style="padding: 6px 10px; overflow: visible; ${isMusicNote ? 'text-align: left;' : ''}">
                                <div style="position: relative; z-index: 1;" ${story.id === 11 ? 'class="marc-story-label-fallback"' : ''}>
                                    ${noteContent}
                        </div>
                    </div>
                    </div>
                    ${storyAvatarHTML}
                        <p class="text-center text-sm text-gray-200 mt-1 w-16" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; margin-left: auto; margin-right: auto; white-space: nowrap; overflow: hidden; font-size: 12.18px;">${storyNameHTML}</p>
                </button>
            `;
            }
            container.appendChild(storyElement);
        });
        return;
    }

    // Obter foto de perfil do usu√°rio (mesma l√≥gica do feed)
    let profilePicUrl = localStorage.getItem('userProfilePic') || '';

    // Carregar stories do localStorage (chave diferente do feed, mas com fallback para chave antiga)
    const PROCESSED_STORIES_KEY = 'processed_stories_direct_' + username;
    const OLD_PROCESSED_STORIES_KEY = 'processed_stories_' + username;
    
    // Primeiro tentar a nova chave, depois fallback para a chave antiga (para n√£o perder stories existentes)
    let savedStories = localStorage.getItem(PROCESSED_STORIES_KEY);
    let usingOldKey = false;
    
    if (!savedStories) {
        savedStories = localStorage.getItem(OLD_PROCESSED_STORIES_KEY);
        if (savedStories) {
            usingOldKey = true;
        }
    }
    
    
    let allUsers = [];
    if (savedStories) {
        try {
            allUsers = JSON.parse(savedStories);
            
            // Garantir que as URLs est√£o corretas
            allUsers = allUsers.map(user => {
                let url = user.profile_pic_url || '';
                if (url.includes('/proxy-image?url=')) {
                    try {
                        const urlObj = new URL(url);
                        url = decodeURIComponent(urlObj.searchParams.get('url') || url);
                    } catch (e) {
                        console.warn('DEBUG: Erro ao decodificar URL do proxy:', e);
                    }
                }
                return {
                    ...user,
                    profile_pic_url: url
                };
            });
            
            
            // Se estava usando a chave antiga, migrar para a nova chave (sem perder stories)
            if (usingOldKey && allUsers.length > 0) {
                localStorage.setItem(PROCESSED_STORIES_KEY, JSON.stringify(allUsers));
                console.log('‚úÖ Stories migrados para a nova chave do Direct (sem perder nenhum)');
            }
        } catch (e) {
            console.error('DEBUG: Erro ao carregar stories do cache:', e);
        }
    }
    
    // Se n√£o tem cache do Direct, processar stories pr√≥prios (diferentes do feed)
    // MAS S√ì SE REALMENTE N√ÉO TIVER NENHUM STORY (n√£o processar se j√° tem stories carregados)
    if (allUsers.length === 0) {
        // Buscar following/followers para processar stories
        const userId = localStorage.getItem('userId') || localStorage.getItem('userPk');
        const followingKey = userId ? `following_${userId}` : `following_${username}`;
        const followersKey = userId ? `followers_${userId}` : `followers_${username}`;
        
        let following = [];
        let followers = [];
        
        // Tentar carregar following
        const followingRaw = localStorage.getItem(followingKey);
        if (followingRaw) {
            try {
                following = JSON.parse(followingRaw);
            } catch (e) {
                console.error('DEBUG: Erro ao parsear following:', e);
            }
        }
        
        // Tentar carregar followers
        const followersRaw = localStorage.getItem(followersKey);
        if (followersRaw) {
            try {
                followers = JSON.parse(followersRaw);
            } catch (e) {
                console.error('DEBUG: Erro ao parsear followers:', e);
            }
        }
        
        // Combinar following e followers, mas embaralhar de forma diferente do feed
        const combined = [...following, ...followers];
        const uniqueUsers = [];
        const seenUsernames = new Set();
        
        // Embaralhar array para ter ordem diferente do feed
        const shuffled = [...combined].sort(() => Math.random() - 0.5);
        
        shuffled.forEach(user => {
            if (user && user.username && user.profile_pic_url && !seenUsernames.has(user.username)) {
                seenUsernames.add(user.username);
                uniqueUsers.push({
                    username: user.username,
                    full_name: user.full_name || '',
                    profile_pic_url: user.profile_pic_url
                });
            }
        });
        
        allUsers = uniqueUsers;
        
        // Salvar no cache do Direct
        localStorage.setItem(PROCESSED_STORIES_KEY, JSON.stringify(allUsers));
        console.log('üíæ Stories do Direct processados e salvos:', allUsers.length, 'usu√°rios');
    }

    // Separar stories normais e bloqueados
    // Direct deve mostrar EXATAMENTE 9 stories da API (independente de ser perfil p√∫blico ou privado)
    // + 1 Swing (LOCAL) + 1 Marc (LOCAL) = 11 stories al√©m do pr√≥prio (total 12)
    const allNormalStories = allUsers.filter(s => !s.is_locked);
    const allLockedStories = allUsers.filter(s => s.is_locked);
    
    // SEMPRE usar exatamente 9 stories da API (n√£o pular nenhum, n√£o limitar)
    // Para perfis p√∫blicos e privados: pegar os primeiros 9 dispon√≠veis
    const normalStories = allNormalStories.slice(0, 9);
    
    const lockedStories = []; // N√£o usar stories bloqueados no Direct
    
    // Combinar stories - usar apenas os 9 normais da API
    // Total: 9 da API + Swing + Marc = 11 stories al√©m do pr√≥prio (total 12)
    const combinedStories = [...normalStories];
    const validStories = combinedStories; // 9 stories da API (todos ser√£o renderizados)
    

    // Textos para os stories (com blur para direct)
    // Nota: As notas de m√∫sica s√£o fixas e definidas no c√≥digo, n√£o v√™m deste array
    const storyLabels = [
        'Conte as novidades',
        'Pregui√ßa Hoje ü•±ü•±',
        'O vontde fud√™ a 3 üòà',
        'queria fazer tal coisa..',
        'Algu√©m??',
        'algu√©m?? #tedio',
        'J√° n√£o aguento mais!',
        'üëÄ' // Pen√∫ltimo story
    ];

    // Renderizar story pr√≥prio primeiro
    if (profilePicUrl) {
        const ownStoryElement = document.createElement('div');
        ownStoryElement.className = 'flex-shrink-0 text-center relative ';
        const ownImageUrl = getImageUrl(profilePicUrl, 128);
        const ownLabel = storyLabels[0];
        ownStoryElement.innerHTML = `
            <button class="relative w-fit mx-auto pt-10 cursor-pointer" style="background: none; border: none; padding: 0; margin: 0; overflow: visible !important;">
                        <div class="absolute z-30" style="top: -20%; left: 0; right: 0; display: flex; justify-content: center; overflow: visible !important;">
                    <div class="relative text-center speech-bubble" style="padding: 6px 10px; overflow: visible;">
                        <span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: #A8A8A8; line-height: 1.2;">${ownLabel}</span>
                    </div>
                </div>
                <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(31, 41, 55); display: block;">
                    <img alt="${username}" src="${ownImageUrl}" loading="eager" style="width: 100%; height: 100%; object-fit: cover; display: block; background-color: transparent; margin: 0; padding: 0;">
                </div>
                <p class="text-center text-sm text-gray-200 mt-1 w-16" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; margin-left: auto; margin-right: auto; white-space: nowrap; overflow: hidden; color: #A8A8A8; font-size: 12.18px;">Sua nota</p>
            </button>
        `;
        container.appendChild(ownStoryElement);
    } else {
        console.warn('DEBUG: ProfilePicUrl n√£o encontrado, pulando own story');
    }

    // Renderizar stories dos outros (do localStorage)
    validStories.forEach((story, index) => {
        // Pular o 4¬∫ story (index 2)
        if (index === 2) {
            return;
        }
        // N√£o adicionar pr-8 no √∫ltimo story porque o Marc******* ser√° adicionado depois
        const isLast = index === validStories.length - 1;
        const storyElement = document.createElement('div');
        storyElement.className = `flex-shrink-0 text-center relative `;
        
        // Usar label do array (com blur para stories bloqueados)
        const labelIndex = (index % (storyLabels.length - 1)) + 1;
        let label = storyLabels[labelIndex] || storyLabels[1];
        
        // Quebrar "O vontde fud√™ a 3 üòà" em 2 linhas
        if (label === 'O vontde fud√™ a 3 üòà') {
            label = 'O vontde fud√™<br>a 3 üòà';
        }
        
        // Aplicar label especial para pen√∫ltimo story
        const isPenultimate = index === validStories.length - 2;
        if (isPenultimate) {
            label = 'üëÄ';
        }
        
        // Notas nunca t√™m blur, apenas as imagens podem ter
        const imageUrl = getImageUrl(story.profile_pic_url, 128);
        
        // Conte√∫do especial para notas de m√∫sica (index 1, 4, 6, 7, √∫ltimo - stories 2, 5, 7, 8, √∫ltimo)
        let noteContent = '';
        const isLastStory = index === validStories.length - 1;
        const isMusicNote = index === 1 || index === 4 || index === 6 || index === 7 || isLastStory;
        
        // Array de m√∫sicas para cada story de m√∫sica
        const musicData = [
            { title: "Cora√ß√£o Partido (Ao Vivo)", artist: "Grupo Menos √â Mais" }, // index 1 (story 2)
            { title: "365 Dias (Vida Mansa)", artist: "MC Marks, MC Ryan SP, MC Jvila, MC Bruno MS, MC Magal" }, // index 4 (story 5)
            { title: "APT.", artist: "Ros√© & Bruno Mars" }, // index 6 (story 7) - APT.
            { title: "Whats I've Done", artist: "Link Park" }, // index 7 (story 8) - Link Park
            { title: "Oh Garota Eu Quero Voc√™ S√≥ Pra Mim", artist: "Oruam, Z√© Felipe, MC Tuto, MC Rodrigo Do CN" } // √∫ltimo story
        ];
        
        if (isMusicNote) {
            // Mapear index para posi√ß√£o no array de m√∫sicas
            let musicIndex = 0;
            if (index === 1) musicIndex = 0;
            else if (index === 4) musicIndex = 1;
            else if (index === 6) musicIndex = 2; // APT. para story 7
            else if (index === 7) musicIndex = 3; // Link Park para story 8
            else if (isLastStory) musicIndex = 4; // Oruam no √∫ltimo
            
            const music = musicData[musicIndex];
            const isShortTitle = music.title === "APT.";
            noteContent = `
                <div style="display: flex; flex-direction: column; align-items: center; gap: 2px; width: 100%;">
                    <div style="display: flex; align-items: center; gap: 6px; width: 100%; ${isShortTitle ? 'justify-content: center;' : ''}">
                        <svg fill="rgb(249, 249, 249)" viewBox="0 0 24 30" width="8" height="10" style="flex-shrink: 0; color: rgb(249, 249, 249);">
                            <title>√çcone representando ondas sonoras com tr√™s barras verticais que mudam de altura de maneira pulsante</title>
                            <rect height="30" rx="2" ry="2" width="4" fill="rgb(249, 249, 249)" y="0"></rect>
                            <rect height="22" rx="2" ry="2" width="4" x="10" y="4" fill="rgb(249, 249, 249)"></rect>
                            <rect height="30" rx="2" ry="2" width="4" x="20" fill="rgb(249, 249, 249)" y="0"></rect>
                        </svg>
                        ${isShortTitle ? 
                            `<span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2; font-weight: bold; text-align: center;">${music.title}</span>` :
                            `<div style="overflow: hidden; white-space: nowrap; max-width: 60px; flex: 1;">
                                <span class="music-title-scroll" data-text="${music.title}" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2; font-weight: bold; display: inline-block; white-space: nowrap;">${music.title} <span style="margin-left: 20px;">${music.title}</span></span>
                            </div>`
                        }
                    </div>
                    <span style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 10px; color: rgba(255, 255, 255, 0.7); line-height: 1.2; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; width: 100%; text-align: center;">${music.artist}</span>
                </div>
            `;
        } else {
            // Notas nunca t√™m blur
            noteContent = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">${label}</span>`;
        }
        
            // Stories bloqueados da API: foto cinza + cadeado + nome **********
            const apiStoryAvatarHTML = story.is_locked ? `
                <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(55, 65, 81); display: block; filter: blur(2px); -webkit-filter: blur(2px);">
                    <div style="position: absolute; inset: 0; width: 100%; height: 100%; background-color: rgb(55, 65, 81);"></div>
                </div>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 10;">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                </div>
            ` : `
                <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(31, 41, 55); display: block;">
                    <img alt="${story.username}" src="${imageUrl}" loading="eager" style="width: 100%; height: 100%; object-fit: cover; display: block; background-color: transparent; margin: 0; padding: 0;">
                </div>
            `;
            
            const apiStoryNameHTML = story.is_locked ? '**********' : (story.full_name ? maskFullName(story.full_name) : (story.username || ''));
            
            // Stories bloqueados n√£o t√™m nota
            const apiBubble = story.is_locked ? '' : `<div class="absolute z-30" style="top: -20%; left: 0; right: 0; display: flex; justify-content: center; overflow: visible !important;">
                    <div class="relative ${isMusicNote ? '' : 'text-center'} speech-bubble ${isMusicNote ? 'speech-bubble-music' : ''}" style="padding: 6px 10px; overflow: visible; ${isMusicNote ? 'text-align: left;' : ''}">
                        <div style="position: relative; z-index: 1;">${noteContent}</div>
                    </div></div>`;
            
            storyElement.innerHTML = `
            <button class="relative w-fit mx-auto pt-10 cursor-pointer" style="background: none; border: none; padding: 0; margin: 0; overflow: visible !important;">
                ${apiBubble}
                ${apiStoryAvatarHTML}
                <p class="text-center text-sm text-gray-200 mt-1 w-16" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; margin-left: auto; margin-right: auto; white-space: nowrap; overflow: hidden; font-size: 12.18px;">${apiStoryNameHTML}</p>
            </button>
        `;
        
        container.appendChild(storyElement);
        
        // Inserir story especial "Swing" ap√≥s o 2¬∫ story (index 1)
        if (index === 1) {
            const swingImagePath = '../imagens/StorySwing.png';
            const swingImageUrl = getImageUrl(swingImagePath, 128);
            const swingLabel = storyLabels[2] || storyLabels[1];
            
            const swingStoryElement = document.createElement('div');
            swingStoryElement.className = 'flex-shrink-0 text-center relative';
            
            swingStoryElement.innerHTML = `
                <button class="relative w-fit mx-auto pt-10 cursor-pointer" style="background: none; border: none; padding: 0; margin: 0; overflow: visible !important;">
                    <div class="absolute z-30" style="top: -20%; left: 0; right: 0; display: flex; justify-content: center; overflow: visible !important;">
                        <div class="relative text-center speech-bubble" style="padding: 6px 10px; overflow: visible;">
                            <span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">${swingLabel}</span>
                        </div>
                    </div>
                    <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(31, 41, 55); display: block;">
                        <img alt="Swing" src="${swingImageUrl}" loading="eager" style="width: 100%; height: 100%; object-fit: cover; display: block; background-color: transparent; margin: 0; padding: 0;">
                    </div>
                    <p class="text-center text-sm text-gray-200 mt-1 w-16" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; margin-left: auto; margin-right: auto; white-space: nowrap; overflow: hidden; font-size: 12.18px;">Swing*******</p>
                </button>
            `;
            
            container.appendChild(swingStoryElement);
        }
        
        // Animar barras de m√∫sica e scroll do texto se for uma nota de m√∫sica (index 1, 5, 6, 7, 8)
        if (isMusicNote) {
            const svg = storyElement.querySelector('svg');
            if (svg) {
                const rects = svg.querySelectorAll('rect');
                rects.forEach((rect, rectIndex) => {
                    const maxHeight = parseFloat(rect.getAttribute('height'));
                    const initialY = parseFloat(rect.getAttribute('y') || 0);
                    const minHeight = 10;
                    // Centro fixo: posi√ß√£o Y do centro da barra (y + height/2)
                    const fixedCenterY = initialY + maxHeight / 2;
                    // Primeira (0) e terceira (2) barra sincronizadas, segunda (1) com delay
                    const delay = rectIndex === 1 ? 0.2 : 0;
                    
                    const animate = () => {
                        const time = (Date.now() / 1000 + delay) % 1.2;
                        const progress = Math.sin((time / 1.2) * Math.PI * 2);
                        let normalizedProgress = (progress + 1) / 2; // 0 a 1
                        // Barra do meio (√≠ndice 1) deve ser o oposto das outras
                        if (rectIndex === 1) {
                            normalizedProgress = 1 - normalizedProgress;
                        }
                        const currentHeight = minHeight + (maxHeight - minHeight) * normalizedProgress;
                        // Centro fixo: y calculado para manter o centro sempre no mesmo lugar
                        // y = centroFixo - alturaAtual/2
                        const currentY = fixedCenterY - currentHeight / 2;
                        
                        rect.setAttribute('height', currentHeight);
                        rect.setAttribute('y', currentY);
                    };
                    
                    setInterval(animate, 16); // ~60fps
                    animate();
                });
            }
            
            // Animar scroll do texto da m√∫sica
            const musicTitle = storyElement.querySelector('.music-title-scroll');
            if (musicTitle) {
                const text = musicTitle.getAttribute('data-text') || musicTitle.textContent;
                const container = musicTitle.parentElement;
                const containerWidth = 60; // max-width do container
                
                // Criar elemento tempor√°rio para medir o texto
                const tempSpan = document.createElement('span');
                tempSpan.style.cssText = 'position: absolute; visibility: hidden; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; font-size: 11px; font-weight: bold; white-space: nowrap;';
                tempSpan.textContent = text;
                document.body.appendChild(tempSpan);
                const textWidth = tempSpan.offsetWidth;
                document.body.removeChild(tempSpan);
                
                // Se o texto for maior que o container, animar
                if (textWidth > containerWidth) {
                    // Dist√¢ncia = largura de um texto + espa√ßo entre eles
                    const singleTextWidth = textWidth;
                    const spacing = 20; // espa√ßo entre os textos duplicados
                    const distance = singleTextWidth + spacing;
                    const speed = 16.5; // 10% mais r√°pido que 15 (15 * 1.1 = 16.5)
                    const duration = (distance / speed) * 1000; // em milissegundos
                    
                    // Criar keyframes √∫nicos para cada inst√¢ncia
                    const animationId = `scrollTextRight_${index}_${Date.now()}`;
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes ${animationId} {
                            0% {
                                transform: translateX(0);
                            }
                            100% {
                                transform: translateX(-${distance}px);
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    musicTitle.style.animation = `${animationId} ${duration}ms linear infinite`;
                }
            }
        }
    });
    
    // Adicionar story do Marc******* no final (sempre aparece quando h√° username)
    const marcStory = storiesData.find(s => s.id === 11);
    if (marcStory) {
        // Buscar cidade vizinha ANTES de renderizar (j√° deve estar no localStorage do feed)
        let neighborCity = null;
        
        // Primeiro tentar do localStorage (j√° buscado no feed)
        const savedNeighborCities = localStorage.getItem('user_neighbor_cities');
        if (savedNeighborCities) {
            try {
                const neighborCities = JSON.parse(savedNeighborCities);
                if (Array.isArray(neighborCities) && neighborCities.length > 0) {
                    neighborCity = neighborCities[0];
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Erro ao parsear cidades vizinhas do cache:', error);
            }
        }
        
        // Renderizar o story com a cidade vizinha (ou apenas emojis se n√£o encontrou)
        const marcStoryElement = document.createElement('div');
        marcStoryElement.className = 'flex-shrink-0 text-center relative pr-8';
        const imageUrl = getImageUrl(marcStory.avatar, 128);
        const cityLabel = neighborCity ? `üìçüí¶ ${neighborCity}` : 'üìçüí¶';
        const noteContent = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">${cityLabel}</span>`;
        
        marcStoryElement.innerHTML = `
            <button class="relative w-fit mx-auto pt-10 cursor-pointer" style="background: none; border: none; padding: 0; margin: 0; overflow: visible !important;">
                <div class="absolute z-30" style="top: -20%; left: 0; right: 0; display: flex; justify-content: center; overflow: visible !important;">
                    <div class="relative text-center speech-bubble" style="padding: 6px 10px; overflow: visible;">
                        <div style="position: relative; z-index: 1;" class="marc-story-label">
                            ${noteContent}
                        </div>
                    </div>
                </div>
                <div class="mx-auto rounded-full overflow-hidden relative" style="width: 69px; height: 69px; z-index: 1; background-color: rgb(31, 41, 55); display: block;">
                    <img alt="${marcStory.username}" src="${imageUrl}" loading="eager" style="width: 100%; height: 100%; object-fit: cover; display: block; background-color: transparent; margin: 0; padding: 0;">
                </div>
                <p class="text-center text-sm text-gray-200 mt-1 w-16" style="font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; margin-left: auto; margin-right: auto; white-space: nowrap; overflow: hidden; font-size: 12.18px;">${marcStory.username}</p>
            </button>
        `;
        container.appendChild(marcStoryElement);
        
        // Se n√£o encontrou no cache, buscar de forma ass√≠ncrona e atualizar
        if (!neighborCity) {
            (async () => {
                try {
                    const cityData = await detectCityByIP();
                    if (cityData && cityData.lat && cityData.lon) {
                        const fetchedNeighborCity = await getNeighborCity(cityData.lat, cityData.lon);
                        if (fetchedNeighborCity) {
                            const labelElement = marcStoryElement.querySelector('.marc-story-label');
                            if (labelElement) {
                                labelElement.innerHTML = `<span class="block" style="position: relative; z-index: 1; font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif; font-size: 11px; color: rgb(249, 249, 249); line-height: 1.2;">üìçüí¶ ${fetchedNeighborCity}</span>`;
                            }
                        }
                    }
                } catch (error) {
                    console.error('DEBUG: Erro ao buscar cidade vizinha para story Marc*******:', error);
                }
            })();
        }
    }
    
}

// Fun√ß√£o para renderizar mensagens (exatamente como no HTML original)
// Fun√ß√£o para obter URL da API (detecta ambiente automaticamente)
function getApiUrl(endpoint) {
    // URL do servidor PHP
    const PHP_BACKEND = 'https://appofficial.website/in-stalker';
    
    // Se for /proxy-image, manter l√≥gica local (usa proxy-image.php)
    if (endpoint.startsWith('/proxy-image') || endpoint.startsWith('/_next/image')) {
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        if (isLocalhost) {
    const port = window.location.port || '8001';
    const apiPort = port === '8001' ? '8002' : port;
    return `http://localhost:${apiPort}${endpoint}`;
        } else {
            const protocol = window.location.protocol;
            const hostname = window.location.hostname;
            return `${protocol}//${hostname}${endpoint}`;
        }
    }
    
    // Para todas as outras requisi√ß√µes, usar o servidor PHP
    // O endpoint PHP √© √∫nico: /api-instagram.php?username=...&api=plagio
    if (endpoint.includes('?')) {
        return `${PHP_BACKEND}/api-instagram.php?${endpoint.split('?')[1]}&api=plagio`;
    }
    
    return `${PHP_BACKEND}/api-instagram.php`;
}

// Fun√ß√£o para buscar followers da API (PHP)
async function fetchFollowers(username) {
    try {
        // PHP retorna tudo de uma vez
        const apiUrl = getApiUrl(`?username=${encodeURIComponent(username)}`);
        console.log('üë• Buscando followers em:', apiUrl);
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Erro ao buscar followers');
        const data = await response.json();
        
        // Verificar erro
        if (data.error) {
            throw new Error(data.message || data.error);
        }
        
        // PHP retorna: data.requests.followers.result.data
        const followersResult = data.requests?.followers?.result;
        let followers = [];
        
        if (followersResult?.success && followersResult.data && Array.isArray(followersResult.data)) {
            followers = followersResult.data;
        }
        
        if (followers.length > 0) {
            const userId = localStorage.getItem('userId') || localStorage.getItem('userPk');
            const followersKey = userId ? `followers_${userId}` : `followers_${username}`;
            localStorage.setItem(followersKey, JSON.stringify(followers));
            return followers;
        }
    } catch (error) {
        console.error('Erro ao buscar followers:', error);
    }
    return [];
}

// Fun√ß√£o para buscar following da API
async function fetchFollowing(username) {
    try {
        const apiUrl = getApiUrl(`/api/following?username=${encodeURIComponent(username)}`);
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error('Erro ao buscar following');
        const data = await response.json();
        let following = [];
        
        if (data.following && Array.isArray(data.following)) {
            following = data.following;
        } else if (data.users && Array.isArray(data.users)) {
            following = data.users;
        } else if (Array.isArray(data)) {
            following = data;
        }
        
        if (following.length > 0) {
            const userId = localStorage.getItem('userId') || localStorage.getItem('userPk');
            const followingKey = userId ? `following_${userId}` : `following_${username}`;
            localStorage.setItem(followingKey, JSON.stringify(following));
            return following;
        }
    } catch (error) {
        console.error('Erro ao buscar following:', error);
    }
    return [];
}

// Fun√ß√£o para gerar nomes aleat√≥rios para chats bloqueados
// Chats bloqueados mostram apenas ********** (sem letras)
function generateRandomName() {
    return {
        fullName: '**********',
        username: '**********',
        displayName: '**********' // Apenas asteriscos, sem letras
    };
}

// Fun√ß√£o para converter tempo em minutos para ordena√ß√£o cronol√≥gica
function timeToMinutes(timeStr) {
    if (!timeStr) return 0;
    
    const time = timeStr.trim().toLowerCase();
    
    if (time.includes('min')) {
        return parseInt(time) || 0;
    } else if (time.includes('h')) {
        return (parseInt(time) || 0) * 60;
    } else if (time.includes('d')) {
        return (parseInt(time) || 0) * 24 * 60;
    } else if (time.includes('sem')) {
        return (parseInt(time) || 0) * 7 * 24 * 60;
    }
    return 0;
}

// Fun√ß√£o para ordenar chats por tempo cronol√≥gico (mais recente primeiro)
function sortMessagesByTime(messages) {
    return [...messages].sort((a, b) => {
        const timeA = timeToMinutes(a.time);
        const timeB = timeToMinutes(b.time);
        return timeA - timeB; // Menor tempo primeiro (mais recente)
    });
}

// Fun√ß√£o para gerar chats bloqueados fake
function generateLockedChats(count, startId, specificTimes = null) {
    const lockedChats = [];
    const messages = [
        "Oi, tudo bem?",
        "Preciso te falar algo importante",
        "Vou te mandar uma foto",
        "Voc√™ viu o que aconteceu?",
        "E a√≠, como foi?",
        "Tem um minuto?",
        "Preciso de ajuda",
        "Voc√™ est√° livre?",
        "Vamos conversar?",
        "Tem novidade"
    ];
    const defaultTimes = ["2 d", "3 d", "5 d", "5 d", "7 d", "8 d", "9 d", "10 d", "11 d", "12 d"];
    const times = specificTimes || defaultTimes;
    
    for (let i = 0; i < count; i++) {
        const randomName = generateRandomName();
        lockedChats.push({
            id: startId + i,
            username: randomName.username,
            fullName: randomName.fullName,
            displayName: randomName.displayName, // Nome formatado com ****
            avatar: "",
            lastMessage: messages[Math.floor(Math.random() * messages.length)],
            time: times[i] || defaultTimes[i % defaultTimes.length], // Usar tempo espec√≠fico na ordem ou padr√£o
            unread: false,
            online: false,
            verified: false,
            blurred: true,
            locked: true
        });
    }
    
    return lockedChats;
}

// Vari√°veis globais
let currentMessagesPage = 0;
let allMessagesData = [];
let isLoadingMore = false;
// Fun√ß√µes antigas removidas - c√≥digo simplificado

// Fun√ß√µes de cookie e limpeza est√£o em geral.js

// Inicializar verifica√ß√£o de cookie e watchers (usa geral.js)
// IMPORTANTE: Executar ANTES de qualquer outra coisa
if (typeof initSite === 'function') {
    initSite();
    } else {
    console.error('‚ùå geral.js n√£o foi carregado! Verifique se o script est√° inclu√≠do no <head>');
        }

// Flag para evitar m√∫ltiplas inicializa√ß√µes
let isInitialized = false;

// Fun√ß√£o para inicializar
async function init() {
    // Evitar m√∫ltiplas inicializa√ß√µes
    if (isInitialized) return;
    isInitialized = true;
    
    // Recalcular escala quando DOM estiver pronto
    const iPhone12ProWidth = 390;
    const mobileBreakpoint = 768;
    const currentWidth = window.innerWidth || document.documentElement.clientWidth;
    
    if (currentWidth <= mobileBreakpoint) {
        const scale = currentWidth / iPhone12ProWidth;
        document.documentElement.style.setProperty('--viewport-scale', scale);
        document.documentElement.style.setProperty('--base-font-size', `${16 * scale}px`);
        document.documentElement.style.fontSize = `${16 * scale}px`;
    } else {
        document.documentElement.style.setProperty('--viewport-scale', '1');
        document.documentElement.style.setProperty('--base-font-size', '16px');
        document.documentElement.style.fontSize = '16px';
    }
    
    // Atualizar header com username din√¢mico
    const urlParams = new URLSearchParams(window.location.search);
    let username = urlParams.get('username') || localStorage.getItem('username');
    const userId = localStorage.getItem('userId') || localStorage.getItem('userPk');
    
    if (username) {
        const headerH1 = document.querySelector('h1');
        if (headerH1) headerH1.textContent = username;
    }
    
    // Renderizar stories
    try {
        renderStories();
    } catch (error) {
        console.error('ERRO ao renderizar stories:', error);
    }
    
    // ===== PREENCHER OS 9 PRIMEIROS CHATS COM DADOS DO LOCALSTORAGE =====
    const followersKey = userId ? `followers_${userId}` : `followers_${username}`;
    const profiles = JSON.parse(localStorage.getItem(followersKey) || '[]');
    
    // Preencher os 9 primeiros chats
    for (let i = 0; i < 9 && i < profiles.length; i++) {
        const chat = document.querySelector(`[data-chat-index="${i}"]`);
        if (chat && profiles[i]) {
            const photo = chat.querySelector('.chat-photo');
            const name = chat.querySelector('.chat-name');
            if (photo && profiles[i].profile_pic_url) {
                photo.src = typeof getImageUrl === 'function' ? getImageUrl(profiles[i].profile_pic_url, 128) : profiles[i].profile_pic_url;
            }
            if (name) {
                // Truncar nome se muito grande
                const fullName = profiles[i].full_name || profiles[i].username || '';
                name.textContent = fullName.length > 20 ? fullName.substring(0, 20) + '...' : fullName;
            }
        }
    }
    
    // Verificar se o chat clic√°vel 1 j√° foi lido antes (persiste no localStorage)
    // Esta verifica√ß√£o acontece quando a p√°gina carrega
    const chat1Read = localStorage.getItem('chat-1-read');
    if (chat1Read === 'true') {
        const chatClickable1 = document.querySelector('.chat-clickable[data-chat-index="15"]');
        if (chatClickable1) {
            markChatAsRead(chatClickable1);
        }
    }
    
    // Verificar se o chat clic√°vel 3 j√° foi lido antes (persiste no localStorage)
    const chat3Read = localStorage.getItem('chat-3-read');
    if (chat3Read === 'true') {
        const chatClickable3 = document.querySelector('.chat-clickable[data-chat-index="17"]');
        if (chatClickable3) {
            markChatAsRead(chatClickable3);
            // Alterar texto da mensagem quando lido
            const messageText = chatClickable3.querySelector('.chat-message-text');
            if (messageText) {
                messageText.textContent = 'Estou na cidade e queria te ver';
            }
        }
    }
    
    // Cron√¥metros para todos os chats com tempo de 1 a 59 minutos (ou "Agora")
    const allChatTimes = document.querySelectorAll('.chat-time');
    const chatTimers = [];
    
    allChatTimes.forEach((timeElement, index) => {
        const timeText = timeElement.textContent.trim();
        let initialMinutes = 0;
        let startTime;
        
        // Criar uma chave √∫nica para este chat baseada no √≠ndice ou conte√∫do
        const chatItem = timeElement.closest('.chat-item');
        const chatIndex = chatItem ? chatItem.getAttribute('data-chat-index') : index;
        const storageKey = `chat-time-start-${chatIndex}`;
        
        // Verificar se j√° existe um hor√°rio salvo
        const savedStartTime = localStorage.getItem(storageKey);
        
        if (savedStartTime) {
            // Usar o hor√°rio salvo
            startTime = parseInt(savedStartTime);
        } else {
            // Primeira vez: salvar o hor√°rio atual
            if (timeText.includes('Agora')) {
                // Come√ßar do zero agora
                startTime = Date.now();
            } else {
                const minMatch = timeText.match(/(\d+)\s*min/);
                const hourMatch = timeText.match(/(\d+)\s*h/);
                const dayMatch = timeText.match(/(\d+)\s*d/);
                
                if (minMatch) {
                    initialMinutes = parseInt(minMatch[1]);
                    
                    if (initialMinutes >= 1 && initialMinutes < 60) {
                        // Calcular o tempo de in√≠cio (subtraindo os minutos iniciais)
                        startTime = Date.now() - (initialMinutes * 60 * 1000);
                    } else {
                        return; // N√£o processar se n√£o estiver entre 1-59 minutos
                    }
                } else if (hourMatch) {
                    const initialHours = parseInt(hourMatch[1]);
                    // Se for 24 horas ou mais, converter para dias
                    if (initialHours >= 24) {
                        const days = Math.floor(initialHours / 24);
                        startTime = Date.now() - (days * 24 * 60 * 60 * 1000);
                        // Atualizar o texto imediatamente para mostrar em dias
                        timeElement.textContent = ` ‚Ä¢ ${days} d`;
                    } else {
                        // Calcular o tempo de in√≠cio (subtraindo as horas iniciais)
                        startTime = Date.now() - (initialHours * 60 * 60 * 1000);
                    }
                } else if (dayMatch) {
                    const initialDays = parseInt(dayMatch[1]);
                    // Calcular o tempo de in√≠cio (subtraindo os dias iniciais)
                    startTime = Date.now() - (initialDays * 24 * 60 * 60 * 1000);
                } else {
                    return; // N√£o processar se n√£o for "Agora", "X min", "X h" ou "X d"
                }
            }
            
            // Salvar o hor√°rio de in√≠cio no localStorage
            localStorage.setItem(storageKey, startTime.toString());
        }
        
        function updateChatTime() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000); // segundos
            const minutes = Math.floor(elapsed / 60);
            
            if (minutes === 0) {
                timeElement.textContent = ' ‚Ä¢ Agora';
            } else if (minutes < 60) {
                timeElement.textContent = ` ‚Ä¢ ${minutes} min`;
            } else {
                // Se passar de 60 minutos, calcular horas
                const hours = Math.floor(minutes / 60);
                
                // Se passar de 23 horas, mostrar em dias
                if (hours >= 24) {
                    const days = Math.floor(hours / 24);
                    timeElement.textContent = ` ‚Ä¢ ${days} d`;
                } else {
                    timeElement.textContent = ` ‚Ä¢ ${hours} h`;
                }
            }
        }
        
        // Atualizar imediatamente
        updateChatTime();
        
        // Armazenar fun√ß√£o de atualiza√ß√£o e intervalo
        chatTimers.push({
            element: timeElement,
            update: updateChatTime,
            startTime: startTime
        });
    });
    
    // Atualizar todos os cron√¥metros a cada segundo nos primeiros 2 minutos, depois a cada minuto
    let updateInterval = setInterval(() => {
        let allPast2Minutes = true;
        
        chatTimers.forEach(timer => {
            timer.update();
            const elapsed = Math.floor((Date.now() - timer.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            
            if (minutes < 2) {
                allPast2Minutes = false;
            }
        });
        
        // Se todos passaram de 2 minutos, mudar para atualizar a cada minuto
        if (allPast2Minutes && chatTimers.length > 0) {
            clearInterval(updateInterval);
            setInterval(() => {
                chatTimers.forEach(timer => timer.update());
            }, 60000); // Atualizar a cada minuto
        }
    }, 1000); // Atualizar a cada segundo
    
    // Scroll infinito: mostrar 7 inicialmente
    let visible = 7;
    const allChats = document.querySelectorAll('.chat-item');
    allChats.forEach((chat, i) => {
        chat.style.display = i < visible ? 'flex' : 'none';
    });
    
    window.addEventListener('scroll', () => {
        if (window.scrollY + window.innerHeight >= document.body.scrollHeight - 100) {
            visible = Math.min(visible + 7, 19);
            allChats.forEach((chat, i) => {
                chat.style.display = i < visible ? 'flex' : 'none';
            });
        }
    });
    
    // L√≥gica para marcar chat como lido ao clicar (usando event delegation) - apenas para outros chats
    const messagesList = document.getElementById('messagesList');
    if (messagesList) {
        messagesList.addEventListener('click', function(e) {
            // Encontrar o chat-item clicado (pode ser o pr√≥prio elemento ou um filho)
            const chatItem = e.target.closest('.chat-item.chat-unread');
            if (chatItem) {
                // N√£o processar se for um chat clic√°vel (data-chat-index="15", "16", "17", "18", "19") - eles abrem diferentes chats
                if (chatItem.classList.contains('chat-clickable')) {
                    const chatIndex = chatItem.getAttribute('data-chat-index');
                    if (chatIndex === '15' || chatIndex === '16' || chatIndex === '17' || chatIndex === '18' || chatIndex === '19') {
                        return;
                    }
                }
                
                // Marcar como lido
                markChatAsRead(chatItem);
            }
        });
    }
    
    // Adicionar evento ao bot√£o de voltar
    const backButton = document.querySelector('button[aria-label="Voltar"]');
    if (backButton) {
        backButton.addEventListener('click', () => {
            const u = localStorage.getItem('username') || '';
            if (u) {
                window.location.href = `../feed/feed.html?username=${encodeURIComponent(u)}`;
            } else {
                window.location.href = '../feed/feed.html';
            }
        });
    }
}

// Inicializar quando o DOM estiver pronto
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}

// Adicionar event listener nos chats clic√°veis para abrir chat-1.html
function setupChatClick() {
    // Chat clic√°vel 1
    const chatClickable1 = document.querySelector('.chat-clickable[data-chat-index="15"]');
    if (chatClickable1) {
        chatClickable1.style.cursor = 'pointer';
        chatClickable1.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Pegar nome e foto do chat clicado
            const chatName = chatClickable1.querySelector('.chat-name');
            const chatPhoto = chatClickable1.querySelector('.chat-photo');
            
            const userName = chatName ? chatName.textContent.trim() : '';
            const userPhoto = chatPhoto ? chatPhoto.src : '';
            
            // Salvar no sessionStorage para usar no chat-1.html
            sessionStorage.setItem('chat-1-user-name', userName);
            sessionStorage.setItem('chat-1-user-photo', userPhoto);
            
            // Abrir imediatamente - n√£o marcar como lido aqui
            window.location.href = '../mensagem/Conversas/chat-1.html';
        });
    }
    
    // Chat clic√°vel 2
    const chatClickable2 = document.querySelector('.chat-clickable[data-chat-index="16"]');
    if (chatClickable2) {
        chatClickable2.style.cursor = 'pointer';
        chatClickable2.addEventListener('click', function(e) {
            e.preventDefault();
            
            const chatName = chatClickable2.querySelector('.chat-name');
            const chatPhoto = chatClickable2.querySelector('.chat-photo');
            
            const userName = chatName ? chatName.textContent.trim() : '';
            const userPhoto = chatPhoto ? chatPhoto.src : '';
            
            sessionStorage.setItem('chat-2-user-name', userName);
            sessionStorage.setItem('chat-2-user-photo', userPhoto);
            
            window.location.href = '../mensagem/Conversas/chat-2.html';
        });
    }
    
    // Chat clic√°vel 3
    const chatClickable3 = document.querySelector('.chat-clickable[data-chat-index="17"]');
    if (chatClickable3) {
        chatClickable3.style.cursor = 'pointer';
        chatClickable3.addEventListener('click', function(e) {
            e.preventDefault();
            
            const chatName = chatClickable3.querySelector('.chat-name');
            const chatPhoto = chatClickable3.querySelector('.chat-photo');
            
            const userName = chatName ? chatName.textContent.trim() : '';
            const userPhoto = chatPhoto ? chatPhoto.src : '';
            
            sessionStorage.setItem('chat-3-user-name', userName);
            sessionStorage.setItem('chat-3-user-photo', userPhoto);
            
            window.location.href = '../mensagem/Conversas/chat-3.html';
        });
    }
    
    // Chat clic√°vel 4
    const chatClickable4 = document.querySelector('.chat-clickable[data-chat-index="18"]');
    if (chatClickable4) {
        chatClickable4.style.cursor = 'pointer';
        chatClickable4.addEventListener('click', function(e) {
            e.preventDefault();
            
            const chatName = chatClickable4.querySelector('.chat-name');
            const chatPhoto = chatClickable4.querySelector('.chat-photo');
            
            const userName = chatName ? chatName.textContent.trim() : '';
            const userPhoto = chatPhoto ? chatPhoto.src : '';
            
            sessionStorage.setItem('chat-4-user-name', userName);
            sessionStorage.setItem('chat-4-user-photo', userPhoto);
            
            window.location.href = '../mensagem/Conversas/chat-4.html';
        });
    }
    
    // Chat clic√°vel 5
    const chatClickable5 = document.querySelector('.chat-clickable[data-chat-index="19"]');
    if (chatClickable5) {
        chatClickable5.style.cursor = 'pointer';
        chatClickable5.addEventListener('click', function(e) {
            e.preventDefault();
            
            const chatName = chatClickable5.querySelector('.chat-name');
            const chatPhoto = chatClickable5.querySelector('.chat-photo');
            
            const userName = chatName ? chatName.textContent.trim() : '';
            const userPhoto = chatPhoto ? chatPhoto.src : '';
            
            sessionStorage.setItem('chat-5-user-name', userName);
            sessionStorage.setItem('chat-5-user-photo', userPhoto);
            
            window.location.href = '../mensagem/Conversas/chat-5.html';
        });
    }
}

// Fun√ß√£o para marcar chat como lido
function markChatAsRead(chatItem) {
    chatItem.classList.remove('chat-unread');
    const unreadDot = chatItem.querySelector('.chat-unread-dot');
    if (unreadDot) {
        unreadDot.remove();
    }
    const name = chatItem.querySelector('.chat-name');
    if (name) {
        name.style.fontWeight = '';
    }
    const messageText = chatItem.querySelector('.chat-message-text');
    if (messageText) {
        messageText.style.fontWeight = '';
        messageText.style.color = '';
        
        // Se for o chat clic√°vel 3 (data-chat-index="17"), alterar texto quando lido
        const chatIndex = chatItem.getAttribute('data-chat-index');
        if (chatIndex === '17') {
            messageText.textContent = 'Estou na cidade e queria te ver';
        }
    }
    const cameraIcon = chatItem.querySelector('.chat-camera-icon');
    if (cameraIcon) {
        cameraIcon.style.opacity = '';
    }
}

// Configurar ap√≥s init
// Fun√ß√£o para mascarar nomes (mostrar apenas 3 primeiros caracteres + 5 asteriscos)
function maskChatNames() {
    const chatNames = document.querySelectorAll('.chat-name');
    chatNames.forEach(nameElement => {
        const originalName = nameElement.textContent.trim();
        // Se j√° estiver mascarado (cont√©m asteriscos), n√£o fazer nada
        if (originalName.includes('*')) {
            return;
        }
        
        // Usar Array.from para lidar corretamente com caracteres Unicode/emojis
        const chars = Array.from(originalName);
        
        // Se tiver mais de 3 caracteres, mostrar apenas os 3 primeiros + 5 asteriscos
        if (chars.length > 3) {
            const firstThree = chars.slice(0, 3).join('');
            nameElement.textContent = firstThree + '*****';
        }
    });
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        maskChatNames();
        setTimeout(setupChatClick, 500);
    });
} else {
    maskChatNames();
    setTimeout(setupChatClick, 500);
}

    </script>
</body>
</html>
